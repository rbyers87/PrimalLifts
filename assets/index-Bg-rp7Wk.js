const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-Bb07Wlwz.js","assets/react-vendor-DE-6VouJ.js"])))=>i.map(i=>d[i]);
import{r as m,a as rs,g as ss,c as X,b as fr}from"./react-vendor-DE-6VouJ.js";import{N as ns,u as Et,a as as,L as Ze,H as is,R as os,b as te}from"./router-vendor-BkIQWp5j.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var mr={exports:{}},rt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cs=m,ls=Symbol.for("react.element"),ds=Symbol.for("react.fragment"),us=Object.prototype.hasOwnProperty,hs=cs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fs={key:!0,ref:!0,__self:!0,__source:!0};function gr(s,e,t){var r,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)us.call(e,r)&&!fs.hasOwnProperty(r)&&(n[r]=e[r]);if(s&&s.defaultProps)for(r in e=s.defaultProps,e)n[r]===void 0&&(n[r]=e[r]);return{$$typeof:ls,type:s,key:i,ref:o,props:n,_owner:hs.current}}rt.Fragment=ds;rt.jsx=gr;rt.jsxs=gr;mr.exports=rt;var a=mr.exports,pr,Rt=rs;pr=Rt.createRoot,Rt.hydrateRoot;const ms="modulepreload",gs=function(s){return"/PrimalLifts/"+s},Lt={},Se=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(l=>{if(l=gs(l),l in Lt)return;Lt[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":ms,u||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return n.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},ps=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Se(async()=>{const{default:r}=await Promise.resolve().then(()=>Ee);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ct extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class ys extends Ct{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class xs extends Ct{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ws extends Ct{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var wt;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(wt||(wt={}));var bs=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class vs{constructor(e,{headers:t={},customFetch:r,region:n=wt.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=ps(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return bs(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let c={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(c["x-region"]=l);let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(c["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(c["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),n),body:u}).catch(x=>{throw new ys(x)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new xs(d);if(!d.ok)throw new ws(d);let f=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield d.json():f==="application/octet-stream"?g=yield d.blob():f==="text/event-stream"?g=d:f==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null}}catch(n){return{data:null,error:n}}})}}var G={},Pt={},st={},We={},nt={},at={},_s=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ne=_s();const ks=Ne.fetch,yr=Ne.fetch.bind(Ne),xr=Ne.Headers,js=Ne.Request,Ss=Ne.Response,Ee=Object.freeze(Object.defineProperty({__proto__:null,Headers:xr,Request:js,Response:Ss,default:yr,fetch:ks},Symbol.toStringTag,{value:"Module"})),Ns=ss(Ee);var it={};Object.defineProperty(it,"__esModule",{value:!0});let Es=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};it.default=Es;var wr=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(at,"__esModule",{value:!0});const Cs=wr(Ns),Ps=wr(it);let Ts=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Cs.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,c,l;let u=null,d=null,h=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const v=await i.text();v===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=v:d=JSON.parse(v))}const p=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");p&&w&&w.length>1&&(h=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,h=null,f=406,g="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const p=await i.text();try{u=JSON.parse(p),Array.isArray(u)&&i.status===404&&(d=[],u=null,f=200,g="OK")}catch{i.status===404&&p===""?(f=204,g="No Content"):u={message:p}}if(u&&this.isMaybeSingle&&(!((l=u==null?void 0:u.details)===null||l===void 0)&&l.includes("0 rows"))&&(u=null,f=200,g="OK"),u&&this.shouldThrowOnError)throw new Ps.default(u)}return{error:u,data:d,count:h,status:f,statusText:g}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,c,l;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(c=i==null?void 0:i.stack)!==null&&c!==void 0?c:""}`,hint:"",code:`${(l=i==null?void 0:i.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};at.default=Ts;var Os=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(nt,"__esModule",{value:!0});const Ds=Os(at);let $s=class extends Ds.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",c=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${c?`${c},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var c;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(c=this.headers.Accept)!==null&&c!==void 0?c:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${l};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};nt.default=$s;var As=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(We,"__esModule",{value:!0});const Ms=As(nt);let Rs=class extends Ms.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};We.default=Rs;var Ls=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(st,"__esModule",{value:!0});const Te=Ls(We);let Is=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Te.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(o.length>0){const c=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new Te.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const o="POST",c=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&c.push(this.headers.Prefer),n&&c.push(`count=${n}`),i||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(e)){const l=e.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new Te.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new Te.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Te.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};st.default=Is;var ot={},ct={};Object.defineProperty(ct,"__esModule",{value:!0});ct.version=void 0;ct.version="0.0.0-automated";Object.defineProperty(ot,"__esModule",{value:!0});ot.DEFAULT_HEADERS=void 0;const Us=ct;ot.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Us.version}`};var br=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pt,"__esModule",{value:!0});const Fs=br(st),Ws=br(We),qs=ot;let Bs=class vr{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},qs.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Fs.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new vr(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let o;const c=new URL(`${this.url}/rpc/${e}`);let l;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{c.searchParams.append(d,h)})):(o="POST",l=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new Ws.default({method:o,url:c,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Pt.default=Bs;var Ce=X&&X.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(G,"__esModule",{value:!0});G.PostgrestError=G.PostgrestBuilder=G.PostgrestTransformBuilder=G.PostgrestFilterBuilder=G.PostgrestQueryBuilder=G.PostgrestClient=void 0;const _r=Ce(Pt);G.PostgrestClient=_r.default;const kr=Ce(st);G.PostgrestQueryBuilder=kr.default;const jr=Ce(We);G.PostgrestFilterBuilder=jr.default;const Sr=Ce(nt);G.PostgrestTransformBuilder=Sr.default;const Nr=Ce(at);G.PostgrestBuilder=Nr.default;const Er=Ce(it);G.PostgrestError=Er.default;var Hs=G.default={PostgrestClient:_r.default,PostgrestQueryBuilder:kr.default,PostgrestFilterBuilder:jr.default,PostgrestTransformBuilder:Sr.default,PostgrestBuilder:Nr.default,PostgrestError:Er.default};const{PostgrestClient:zs,PostgrestQueryBuilder:wc,PostgrestFilterBuilder:bc,PostgrestTransformBuilder:vc,PostgrestBuilder:_c,PostgrestError:kc}=Hs,Js="2.11.2",Vs={"X-Client-Info":`realtime-js/${Js}`},Ys="1.0.0",Cr=1e4,Gs=1e3;var je;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(je||(je={}));var K;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(K||(K={}));var Z;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(Z||(Z={}));var bt;(function(s){s.websocket="websocket"})(bt||(bt={}));var me;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(me||(me={}));class Ks{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const c=r.decode(e.slice(o,o+n));o=o+n;const l=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:l,payload:u}}}class Pr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var I;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(I||(I={}));const It=(s,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Qs(o,s,e,n),i),{})},Qs=(s,e,t,r)=>{const n=e.find(c=>c.name===s),i=n==null?void 0:n.type,o=t[s];return i&&!r.includes(i)?Tr(i,o):vt(o)},Tr=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return tn(e,t)}switch(s){case I.bool:return Xs(e);case I.float4:case I.float8:case I.int2:case I.int4:case I.int8:case I.numeric:case I.oid:return Zs(e);case I.json:case I.jsonb:return en(e);case I.timestamp:return rn(e);case I.abstime:case I.date:case I.daterange:case I.int4range:case I.int8range:case I.money:case I.reltime:case I.text:case I.time:case I.timestamptz:case I.timetz:case I.tsrange:case I.tstzrange:return vt(e);default:return vt(e)}},vt=s=>s,Xs=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Zs=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},en=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},tn=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let i;const o=s.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(c=>Tr(e,c))}return s},rn=s=>typeof s=="string"?s.replace(" ","T"):s,Or=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class dt{constructor(e,t,r={},n=Cr){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ut;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Ut||(Ut={}));class Me{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Me.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Me.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],c()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Me.syncDiff(this.state,n,i,o),c())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const i=this.cloneDeep(e),o=this.transformState(t),c={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const f=d.map(w=>w.presence_ref),g=h.map(w=>w.presence_ref),x=d.filter(w=>g.indexOf(w.presence_ref)<0),p=h.filter(w=>f.indexOf(w.presence_ref)<0);x.length>0&&(c[u]=x),p.length>0&&(l[u]=p)}else c[u]=d}),this.syncDiff(i,{joins:c,leaves:l},r,n)}static syncDiff(e,t,r,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(c,l)=>{var u;const d=(u=e[c])!==null&&u!==void 0?u:[];if(e[c]=this.cloneDeep(l),d.length>0){const h=e[c].map(g=>g.presence_ref),f=d.filter(g=>h.indexOf(g.presence_ref)<0);e[c].unshift(...f)}r(c,d,l)}),this.map(o,(c,l)=>{let u=e[c];if(!u)return;const d=l.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[c]=u,n(c,u,l),u.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ft;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Ft||(Ft={}));var Wt;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Wt||(Wt={}));var re;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(re||(re={}));class Tt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=K.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new dt(this,Z.join,this.params,this.timeout),this.rejoinTimer=new Pr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=K.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=K.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=K.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=K.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Z.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Me(this),this.broadcastEndpointURL=Or(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:c}}=this.params;this._onError(d=>e==null?void 0:e(re.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(re.CLOSED));const l={},u={broadcast:i,presence:o,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&n!==void 0?n:[],private:c};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e==null||e(re.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,x=[];for(let p=0;p<g;p++){const w=f[p],{filter:{event:v,schema:y,table:k,filter:P}}=w,D=d&&d[p];if(D&&D.event===v&&D.schema===y&&D.table===k&&D.filter===P)x.push(Object.assign(Object.assign({},w),{id:D.id}));else{this.unsubscribe(),e==null||e(re.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(re.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(re.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(re.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,c,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(c=(o=this.params)===null||o===void 0?void 0:o.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=K.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Z.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new dt(this,Z.leave,{},e);n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new dt(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,i;const o=e.toLocaleLowerCase(),{close:c,error:l,leave:u,join:d}=Z;if(r&&[c,l,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(g=>{var x,p,w;return((x=g.filter)===null||x===void 0?void 0:x.event)==="*"||((w=(p=g.filter)===null||p===void 0?void 0:p.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(g=>g.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(g=>{var x,p,w,v,y,k;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const P=g.id,D=(x=g.filter)===null||x===void 0?void 0:x.event;return P&&((p=t.ids)===null||p===void 0?void 0:p.includes(P))&&(D==="*"||(D==null?void 0:D.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const P=(y=(v=g==null?void 0:g.filter)===null||v===void 0?void 0:v.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return P==="*"||P===((k=t==null?void 0:t.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof f=="object"&&"ids"in f){const x=f.data,{schema:p,table:w,commit_timestamp:v,type:y,errors:k}=x;f=Object.assign(Object.assign({},{schema:p,table:w,commit_timestamp:v,eventType:y,new:{},old:{},errors:k}),this._getPayloadRecords(x))}g.callback(f,r)})}_isClosed(){return this.state===K.closed}_isJoined(){return this.state===K.joined}_isJoining(){return this.state===K.joining}_isLeaving(){return this.state===K.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Tt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Z.close,{},e)}_onError(e){this._on(Z.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=K.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=It(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=It(e.columns,e.old_record)),t}}const sn=()=>{},nn=typeof WebSocket<"u",an=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class on{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Vs,this.params={},this.timeout=Cr,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=sn,this.conn=null,this.sendBuffer=[],this.serializer=new Ks,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...c)=>Se(async()=>{const{default:l}=await Promise.resolve().then(()=>Ee);return{default:l}},void 0).then(({default:l})=>l(...c)):o=fetch,(...c)=>o(...c)},this.endPoint=`${e}/${bt.websocket}`,this.httpEndpoint=Or(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Pr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(nn){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new cn(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Se(async()=>{const{default:e}=await import("./browser-Bb07Wlwz.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ys}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case je.connecting:return me.Connecting;case je.open:return me.Open;case je.closing:return me.Closing;default:return me.Closed}}isConnected(){return this.connectionState()===me.Open}channel(e,t={config:{}}){const r=new Tt(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:n,ref:i}=e,o=()=>{this.encode(e,c=>{var l;(l=this.conn)===null||l===void 0||l.send(c)})};this.log("push",`${t} ${r} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(Z.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Gs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Z.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([an],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class cn{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=je.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Ot extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function B(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class ln extends Ot{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class _t extends Ot{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var dn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const Dr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Se(async()=>{const{default:r}=await Promise.resolve().then(()=>Ee);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},un=()=>dn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Se(()=>Promise.resolve().then(()=>Ee),void 0)).Response:Response}),kt=s=>{if(Array.isArray(s))return s.map(t=>kt(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=kt(r)}),e};var ye=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const ut=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),hn=(s,e,t)=>ye(void 0,void 0,void 0,function*(){const r=yield un();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(n=>{e(new ln(ut(n),s.status||500))}).catch(n=>{e(new _t(ut(n),n))}):e(new _t(ut(s),s))}),fn=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),t))};function qe(s,e,t,r,n,i){return ye(this,void 0,void 0,function*(){return new Promise((o,c)=>{s(t,fn(e,r,n,i)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>hn(l,c,r))})})}function et(s,e,t,r){return ye(this,void 0,void 0,function*(){return qe(s,"GET",e,t,r)})}function ie(s,e,t,r,n){return ye(this,void 0,void 0,function*(){return qe(s,"POST",e,r,n,t)})}function mn(s,e,t,r,n){return ye(this,void 0,void 0,function*(){return qe(s,"PUT",e,r,n,t)})}function gn(s,e,t,r){return ye(this,void 0,void 0,function*(){return qe(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function $r(s,e,t,r,n){return ye(this,void 0,void 0,function*(){return qe(s,"DELETE",e,r,n,t)})}var Y=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const pn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},qt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class yn{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Dr(n)}uploadOrUpdate(e,t,r,n){return Y(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},qt),n);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,c["cache-control"]=`max-age=${o.cacheControl}`,c["content-type"]=o.contentType,l&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n!=null&&n.headers&&(c=Object.assign(Object.assign({},c),n.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:c},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(B(i))return{data:null,error:i};throw i}})}upload(e,t,r){return Y(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return Y(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),c=new URL(this.url+`/object/upload/sign/${o}`);c.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:qt.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield this.fetch(c.toString(),{method:"PUT",body:l,headers:d}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(B(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Y(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield ie(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+i.url),c=o.searchParams.get("token");if(!c)throw new Ot("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:c},error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}update(e,t,r){return Y(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Y(this,void 0,void 0,function*(){try{return{data:yield ie(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}copy(e,t,r){return Y(this,void 0,void 0,function*(){try{return{data:{path:(yield ie(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return Y(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield ie(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return Y(this,void 0,void 0,function*(){try{const n=yield ie(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}download(e,t){return Y(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield et(this.fetch,`${this.url}/${n}/${c}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(B(c))return{data:null,error:c};throw c}})}info(e){return Y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield et(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:kt(r),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}exists(e){return Y(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield gn(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(B(r)&&r instanceof _t){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&n.push(l);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${r}${u}`)}}}remove(e){return Y(this,void 0,void 0,function*(){try{return{data:yield $r(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}list(e,t,r){return Y(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},pn),t),{prefix:e||""});return{data:yield ie(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const xn="2.7.1",wn={"X-Client-Info":`storage-js/${xn}`};var we=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class bn{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},wn),t),this.fetch=Dr(r)}listBuckets(){return we(this,void 0,void 0,function*(){try{return{data:yield et(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(B(e))return{data:null,error:e};throw e}})}getBucket(e){return we(this,void 0,void 0,function*(){try{return{data:yield et(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return we(this,void 0,void 0,function*(){try{return{data:yield ie(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return we(this,void 0,void 0,function*(){try{return{data:yield mn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}})}emptyBucket(e){return we(this,void 0,void 0,function*(){try{return{data:yield ie(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}deleteBucket(e){return we(this,void 0,void 0,function*(){try{return{data:yield $r(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}})}}class vn extends bn{constructor(e,t={},r){super(e,t,r)}from(e){return new yn(this.url,this.headers,e,this.fetch)}}const _n="2.49.4";let Ae="";typeof Deno<"u"?Ae="deno":typeof document<"u"?Ae="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ae="react-native":Ae="node";const kn={"X-Client-Info":`supabase-js-${Ae}/${_n}`},jn={headers:kn},Sn={schema:"public"},Nn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},En={};var Cn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};const Pn=s=>{let e;return s?e=s:typeof fetch>"u"?e=yr:e=fetch,(...t)=>e(...t)},Tn=()=>typeof Headers>"u"?xr:Headers,On=(s,e,t)=>{const r=Pn(t),n=Tn();return(i,o)=>Cn(void 0,void 0,void 0,function*(){var c;const l=(c=yield e())!==null&&c!==void 0?c:s;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var Dn=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};function $n(s){return s.replace(/\/$/,"")}function An(s,e){const{db:t,auth:r,realtime:n,global:i}=s,{db:o,auth:c,realtime:l,global:u}=e,d={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},c),r),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},u),i),accessToken:()=>Dn(this,void 0,void 0,function*(){return""})};return s.accessToken?d.accessToken=s.accessToken:delete d.accessToken,d}const Ar="2.69.1",ke=30*1e3,jt=3,ht=jt*ke,Mn="http://localhost:9999",Rn="supabase.auth.token",Ln={"X-Client-Info":`gotrue-js/${Ar}`},St="X-Supabase-Api-Version",Mr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},In=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Un=6e5;class Dt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function $(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Fn extends Dt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Wn(s){return $(s)&&s.name==="AuthApiError"}class Rr extends Dt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class le extends Dt{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class ne extends le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qn(s){return $(s)&&s.name==="AuthSessionMissingError"}class ft extends le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ve extends le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ye extends le{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Bn(s){return $(s)&&s.name==="AuthImplicitGrantRedirectError"}class Bt extends le{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Nt extends le{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function mt(s){return $(s)&&s.name==="AuthRetryableFetchError"}class Ht extends le{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Re extends le{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Jt=` 	
\r=`.split(""),Hn=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Jt.length;e+=1)s[Jt[e].charCodeAt(0)]=-2;for(let e=0;e<zt.length;e+=1)s[zt[e].charCodeAt(0)]=e;return s})();function Lr(s,e,t){const r=Hn[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function Vt(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{Vn(o,r,t)};for(let o=0;o<s.length;o+=1)Lr(s.charCodeAt(o),n,i);return e.join("")}function zn(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function Jn(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}zn(r,e)}}function Vn(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if(!(s>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Yn(s){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<s.length;n+=1)Lr(s.charCodeAt(n),t,r);return new Uint8Array(e)}function Gn(s){const e=[];return Jn(s,t=>e.push(t)),new Uint8Array(e)}function Kn(s){return Math.round(Date.now()/1e3)+s}function Qn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const ee=()=>typeof window<"u"&&typeof document<"u",de={tested:!1,writable:!1},Le=()=>{if(!ee())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(de.tested)return de.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),de.tested=!0,de.writable=!0}catch{de.tested=!0,de.writable=!1}return de.writable};function Xn(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const Ir=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Se(async()=>{const{default:r}=await Promise.resolve().then(()=>Ee);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Zn=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Ur=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Ge=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ke=async(s,e)=>{await s.removeItem(e)};class lt{constructor(){this.promise=new lt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}lt.promiseConstructor=Promise;function gt(s){const e=s.split(".");if(e.length!==3)throw new Re("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!In.test(e[r]))throw new Re("JWT not in base64url format");return{header:JSON.parse(Vt(e[0])),payload:JSON.parse(Vt(e[1])),signature:Yn(e[2]),raw:{header:e[0],payload:e[1]}}}async function ea(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function ta(s,e){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await s(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function ra(s){return("0"+s.toString(16)).substr(-2)}function sa(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,ra).join("")}async function na(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function aa(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await na(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function be(s,e,t=!1){const r=sa();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await Ur(s,`${e}-code-verifier`,n);const i=await aa(r);return[i,r===i?"plain":"s256"]}const ia=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function oa(s){const e=s.headers.get(St);if(!e||!e.match(ia))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ca(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function la(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var da=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};const he=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),ua=[502,503,504];async function Yt(s){var e;if(!Zn(s))throw new Nt(he(s),0);if(ua.includes(s.status))throw new Nt(he(s),s.status);let t;try{t=await s.json()}catch(i){throw new Rr(he(i),i)}let r;const n=oa(s);if(n&&n.getTime()>=Mr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Ht(he(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new ne}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ht(he(t),s.status,t.weak_password.reasons);throw new Fn(he(t),s.status||500,r)}const ha=(s,e,t,r)=>{const n={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function M(s,e,t,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[St]||(i[St]=Mr["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const c=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await fa(s,e,t+c,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function fa(s,e,t,r,n,i){const o=ha(e,r,n,i);let c;try{c=await s(t,Object.assign({},o))}catch(l){throw console.error(l),new Nt(he(l),0)}if(c.ok||await Yt(c),r!=null&&r.noResolveJson)return c;try{return await c.json()}catch(l){await Yt(l)}}function ae(s){var e;let t=null;ya(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Kn(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function Gt(s){const e=ae(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function oe(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function ma(s){return{data:s,error:null}}function ga(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i}=s,o=da(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:c,user:l},error:null}}function pa(s){return s}function ya(s){return s.access_token&&s.refresh_token&&s.expires_in}var xa=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(s);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(s,r[n])&&(t[r[n]]=s[r[n]]);return t};class wa{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ir(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await M(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await M(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:oe})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=xa(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await M(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ga,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if($(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await M(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oe})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,i,o,c,l;try{const u={nextPage:null,lastPage:0,total:0},d=await M(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:pa});if(d.error)throw d.error;const h=await d.json(),f=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(l=(c=d.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(x=>{const p=parseInt(x.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(x.split(";")[1].split("=")[1]);u[`${w}Page`]=p}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if($(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await M(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oe})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await M(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:oe})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await M(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:oe})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await M(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if($(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await M(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}}const ba={getItem:s=>Le()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{Le()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{Le()&&globalThis.localStorage.removeItem(s)}};function Kt(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function va(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ve={debug:!!(globalThis&&Le()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Fr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _a extends Fr{}async function ka(s,e,t){ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ve.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,n.name);try{return await t()}finally{ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,n.name)}}else{if(e===0)throw ve.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new _a(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(ve.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}va();const ja={url:Mn,storageKey:Rn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ln,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Qt(s,e,t){return await t()}class Ie{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ie.nextInstanceID,Ie.nextInstanceID+=1,this.instanceID>0&&ee()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ja),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new wa({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ir(n.fetch),this.lock=n.lock||Qt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ee()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ka:this.lock=Qt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Le()?this.storage=ba:(this.memoryStorage={},this.storage=Kt(this.memoryStorage)):(this.memoryStorage={},this.storage=Kt(this.memoryStorage)),ee()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ar}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Xn(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ee()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Bn(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",c),await this._saveSession(o),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return $(t)?{error:t}:{error:new Rr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const i=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:ae}),{data:o,error:c}=i;if(c||!o)return{data:{user:null,session:null},error:c};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,n;try{let i;if("email"in e){const{email:d,password:h,options:f}=e;let g=null,x=null;this.flowType==="pkce"&&([g,x]=await be(this.storage,this.storageKey)),i=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:x},xform:ae})}else if("phone"in e){const{phone:d,password:h,options:f}=e;i=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:ae})}else throw new Ve("You must provide either an email or phone number and a password");const{data:o,error:c}=i;if(c||!o)return{data:{user:null,session:null},error:c};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:c}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Gt})}else if("phone"in e){const{phone:i,password:o,options:c}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Gt})}else throw new Ve("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ft}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ge(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:i,error:o}=await M(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ae});if(await Ke(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new ft}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if($(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:i,nonce:o}=e,c=await M(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ae}),{data:l,error:u}=c;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ft}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,i,o;try{if("email"in e){const{email:c,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await be(this.storage,this.storageKey));const{error:h}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:c,options:l}=e,{data:u,error:d}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new Ve("You must provide either an email or phone number.")}catch(c){if($(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,r;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:c}=await M(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:ae});if(c)throw c;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if($(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await be(this.storage,this.storageKey)),await M(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ma})}catch(i){if($(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ne;const{error:n}=await M(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if($(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:i}=e,{error:o}=await M(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:i}=e,{data:o,error:c}=await M(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:c}}throw new Ve("You must provide either an email or phone number and a type")}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ge(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ht:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oe}):await this._useSession(async t=>{var r,n,i;const{data:o,error:c}=t;if(c)throw c;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ne}:await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:oe})})}catch(t){if($(t))return qn(t)&&(await this._removeSession(),await Ke(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new ne;const o=n.session;let c=null,l=null;this.flowType==="pkce"&&e.email!=null&&([c,l]=await be(this.storage,this.storageKey));const{data:u,error:d}=await M(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:l}),jwt:o.access_token,xform:oe});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ne;const t=Date.now()/1e3;let r=t,n=!0,i=null;const{payload:o}=gt(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:c,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};i=c}else{const{data:c,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if($(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:c}=t;if(c)throw c;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new ne;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ee())throw new Ye("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ye(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Bt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ye("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Bt("No code detected.");const{data:y,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:c,expires_at:l,token_type:u}=e;if(!i||!c||!o||!u)throw new Ye("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(c);let f=d+h;l&&(f=parseInt(l));const g=f-d;g*1e3<=ke&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const x=f-h;d-x>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",x,f,d):d-x<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",x,f,d);const{data:p,error:w}=await this._getUser(i);if(w)throw w;const v={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(r){if($(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ge(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{error:i};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:c}=await this.admin.signOut(o,e);if(c&&!(Wn(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await Ke(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Qn(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await be(this.storage,this.storageKey,!0));try{return await M(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if($(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async i=>{var o,c,l,u,d;const{data:h,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await M(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return ee()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if($(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)throw o;return await M(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ta(async n=>(n>0&&await ea(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await M(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ae})),(n,i)=>{const o=200*Math.pow(2,n);return i&&mt(i)&&Date.now()+o-r<ke})}catch(r){if(this._debug(t,"error",r),$(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ee()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Ge(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const n=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<ht;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${ht}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),mt(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ne;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new lt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new ne;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const c={session:i.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(i){if(this._debug(n,"error",i),$(i)){const o={session:null,error:i};return mt(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let c=0;c<i.length;c+=1)console.error(i[c]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ur(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ke(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ee()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ke);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/ke);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ke}ms, refresh threshold is ${jt} ticks`),n<=jt&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Fr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ee()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await be(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(c.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await M(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await M(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:c}=await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:i}=t;return i?{data:null,error:i}:await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=gt(n.access_token);let c=null;o.aal&&(c=o.aal);let l=c;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const d=o.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Un>Date.now()))return r;const{data:n,error:i}=await M(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new Re("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),r=n.keys.find(o=>o.kid===e),!r)throw new Re("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:g,error:x}=await this.getSession();if(x||!g.session)return{data:null,error:x};r=g.session.access_token}const{header:n,payload:i,signature:o,raw:{header:c,payload:l}}=gt(r);if(ca(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:i,header:n,signature:o},error:null}}const u=la(n.alg),d=await this.fetchJwk(n.kid,t),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,Gn(`${c}.${l}`)))throw new Re("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}}Ie.nextInstanceID=0;const Sa=Ie;class Na extends Sa{constructor(e){super(e)}}var Ea=function(s,e,t,r){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function c(d){try{u(r.next(d))}catch(h){o(h)}}function l(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):n(d.value).then(c,l)}u((r=r.apply(s,e||[])).next())})};class Ca{constructor(e,t,r){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=$n(e);this.realtimeUrl=`${c}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${c}/auth/v1`,this.storageUrl=`${c}/storage/v1`,this.functionsUrl=`${c}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:Sn,realtime:En,auth:Object.assign(Object.assign({},Nn),{storageKey:l}),global:jn},d=An(r??{},u);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=On(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new zs(`${c}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new vs(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new vn(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ea(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:i,flowType:o,lock:c,debug:l},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Na({url:this.authUrl,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:o,lock:c,debug:l,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new on(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Pa=(s,e,t)=>new Ca(s,e,t),Ta="https://qqyczfaiaoxrdvjjkgfz.supabase.co",Oa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxeWN6ZmFpYW94cmR2amprZ2Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU3NTg3ODMsImV4cCI6MjA1MTMzNDc4M30.tFCj-ZvPZ729yYF66k7OZwIwsfl1NEpCLuYKmAZYVD8",_=Pa(Ta,Oa);console.log("https://qqyczfaiaoxrdvjjkgfz.supabase.co");console.log("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxeWN6ZmFpYW94cmR2amprZ2Z6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU3NTg3ODMsImV4cCI6MjA1MTMzNDc4M30.tFCj-ZvPZ729yYF66k7OZwIwsfl1NEpCLuYKmAZYVD8");const Wr=m.createContext(void 0);function Da({children:s}){const[e,t]=m.useState(null),[r,n]=m.useState(!0);m.useEffect(()=>{_.auth.getSession().then(({data:{session:d}})=>{t((d==null?void 0:d.user)??null),n(!1)});const{data:{subscription:u}}=_.auth.onAuthStateChange((d,h)=>{t((h==null?void 0:h.user)??null),n(!1)});return()=>u.unsubscribe()},[]);const l={user:e,loading:r,signIn:async(u,d)=>{const{error:h}=await _.auth.signInWithPassword({email:u,password:d});if(h)throw h},signUp:async(u,d)=>{const{error:h}=await _.auth.signUp({email:u,password:d});if(h)throw h},signOut:async()=>{const{error:u}=await _.auth.signOut();if(u)throw u}};return a.jsx(Wr.Provider,{value:l,children:!r&&s})}function J(){const s=m.useContext(Wr);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}function ue({children:s}){const{user:e}=J();return e?a.jsx(a.Fragment,{children:s}):a.jsx(ns,{to:"/login"})}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),U=(s,e)=>{const t=m.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:l,...u},d)=>m.createElement("svg",{ref:d,...$a,width:n,height:n,stroke:r,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${Aa(s)}`,c].join(" "),...u},[...e.map(([h,f])=>m.createElement(h,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=U("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=U("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=U("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=U("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=U("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=U("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=U("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=U("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=U("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=U("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=U("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=U("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=U("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=U("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=U("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=U("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=U("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=U("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=U("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=U("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=U("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=U("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=U("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Ka(){const{user:s,signOut:e}=J(),t=Et(),r=as(),[n,i]=m.useState(!1),o=d=>r.pathname===d;if(!s)return null;const c=async()=>{try{await e(),t("/login")}catch(d){console.error("Error signing out:",d)}},l=d=>`h-5 w-5 ${o(d)?"text-indigo-600 dark:text-indigo-400":""}`,u=[{path:"/",icon:a.jsx(qa,{className:l("/")}),label:"Home"},{path:"/wod",icon:a.jsx(xe,{className:l("/wod")}),label:"WOD"},{path:"/workouts",icon:a.jsx(Ja,{className:l("/workouts")}),label:"Workouts"},{path:"/leaderboard",icon:a.jsx(He,{className:l("/leaderboard")}),label:"Leaderboard"},{path:"/messageboard",icon:a.jsx(qr,{className:l("/messageboard")}),label:"Messages"},{path:"/profile",icon:a.jsx($t,{className:l("/profile")}),label:"Profile"}];return a.jsx("nav",{className:"bg-transparent shadow-lg dark:bg-transparent",children:a.jsxs("div",{className:"container mx-auto px-4 bg-transparent",children:[a.jsxs("div",{className:"flex items-center justify-between h-16 relative",children:[a.jsx("button",{onClick:()=>i(!n),className:"p-2 rounded-md dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400",children:n?a.jsx(Ga,{className:"h-6 w-6"}):a.jsx(za,{className:"h-6 w-6"})}),a.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 text-lg font-semibold text-gray-800 dark:text-white",children:"Primal Lifts"}),a.jsx("div",{className:"w-6 h-6"})]}),n&&a.jsxs("div",{className:"px-2 pt-2 pb-4 space-y-1 sm:px-3 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[u.map(d=>a.jsx(Ze,{to:d.path,className:`${o(d.path)?"bg-gray-100 dark:bg-gray-700 text-indigo-600 dark:text-indigo-400":"dark:text-gray-300"} block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50 dark:hover:bg-gray-700`,onClick:()=>i(!1),children:a.jsxs("div",{className:"flex items-center",children:[d.icon,a.jsx("span",{className:"ml-3",children:d.label})]})},d.path)),a.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),a.jsx(Ze,{to:"/settings",className:`${o("/settings")?"bg-gray-100 dark:bg-gray-700 text-indigo-600 dark:text-indigo-400":"dark:text-gray-300"} block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50 dark:hover:bg-gray-700`,onClick:()=>i(!1),children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Va,{className:"h-5 w-5"}),a.jsx("span",{className:"ml-3",children:"Settings"})]})}),a.jsx("button",{onClick:()=>{i(!1),c()},className:"w-full text-left dark:text-gray-300 block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ba,{className:"h-5 w-5"}),a.jsx("span",{className:"ml-3",children:"Sign Out"})]})})]})]})})}function Qa(){const[s,e]=m.useState(""),[t,r]=m.useState(""),[n,i]=m.useState(""),[o,c]=m.useState(!1),l=Et(),{signIn:u}=J(),d=async h=>{h.preventDefault(),i(""),c(!0);try{await u(s,t),l("/")}catch(f){i("Failed to sign in. Please check your credentials."),console.error("Login error:",f)}finally{c(!1)}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center dark:bg-gray-800 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-md w-full space-y-8",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx(xe,{className:"h-12 w-12 text-indigo-600"})}),a.jsx("h2",{className:"mt-6 text-3xl font-extrabold dark:text-gray-100",children:"Sign in to your account"}),a.jsxs("p",{className:"mt-2 text-sm dark:text-gray-300",children:["Or"," ",a.jsx(Ze,{to:"/register",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"create a new account"})]})]}),a.jsxs("form",{className:"mt-8 space-y-6",onSubmit:d,children:[n&&a.jsx("div",{className:"rounded-md bg-red-50 p-4",children:a.jsx("p",{className:"text-sm text-red-700",children:n})}),a.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),a.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:h=>e(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Email address"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),a.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t,onChange:h=>r(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),a.jsx("div",{children:a.jsx("button",{type:"submit",disabled:o,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:o?"Signing in...":"Sign in"})})]})]})})}function Xa(){const[s,e]=m.useState(""),[t,r]=m.useState(""),[n,i]=m.useState(""),[o,c]=m.useState(""),[l,u]=m.useState(""),[d,h]=m.useState(""),[f,g]=m.useState(!1),x=Et(),{signUp:p}=J(),w=async v=>{if(v.preventDefault(),h(""),t!==n){h("Passwords do not match");return}g(!0);try{await p(s,t);const{error:y}=await _.from("profiles").insert([{email:s,first_name:o,last_name:l}]);if(y)throw y;x("/login")}catch(y){h("Failed to create an account."),console.error("Registration error:",y)}finally{g(!1)}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center dark:bg-gray-800 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-md w-full space-y-8",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx(xe,{className:"h-12 w-12 text-indigo-600"})}),a.jsx("h2",{className:"mt-6 text-3xl font-extrabold dark:text-gray-100",children:"Create your account"}),a.jsxs("p",{className:"mt-2 text-sm dark:text-gray-300",children:["Or"," ",a.jsx(Ze,{to:"/login",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"sign in to your account"})]})]}),a.jsxs("form",{className:"mt-8 space-y-6",onSubmit:w,children:[d&&a.jsx("div",{className:"rounded-md bg-red-50 p-4",children:a.jsx("p",{className:"text-sm text-red-700",children:d})}),a.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"firstName",className:"sr-only",children:"First name"}),a.jsx("input",{id:"firstName",name:"firstName",type:"text",required:!0,value:o,onChange:v=>c(v.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"First name"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"lastName",className:"sr-only",children:"Last name"}),a.jsx("input",{id:"lastName",name:"lastName",type:"text",required:!0,value:l,onChange:v=>u(v.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Last name"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),a.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:v=>e(v.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Email address"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),a.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,value:t,onChange:v=>r(v.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Password"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"confirmPassword",className:"sr-only",children:"Confirm password"}),a.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,value:n,onChange:v=>i(v.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 dark:text-gray-100 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Confirm password"})]})]}),a.jsx("div",{children:a.jsx("button",{type:"submit",disabled:f,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:f?"Creating account...":"Create account"})})]})]})})}function W(s){const e=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&e==="[object Date]"?new s.constructor(+s):typeof s=="number"||e==="[object Number]"||typeof s=="string"||e==="[object String]"?new Date(s):new Date(NaN)}function ce(s,e){return s instanceof Date?new s.constructor(e):new Date(e)}function Ue(s,e){const t=W(s);return isNaN(e)?ce(s,NaN):(e&&t.setDate(t.getDate()+e),t)}const Hr=6048e5,Za=864e5,zr=6e4,Jr=36e5;let ei={};function ze(){return ei}function pe(s,e){var c,l,u,d;const t=ze(),r=(e==null?void 0:e.weekStartsOn)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??t.weekStartsOn??((d=(u=t.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,n=W(s),i=n.getDay(),o=(i<r?7:0)+i-r;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function tt(s){return pe(s,{weekStartsOn:1})}function Vr(s){const e=W(s),t=e.getFullYear(),r=ce(s,0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);const n=tt(r),i=ce(s,0);i.setFullYear(t,0,4),i.setHours(0,0,0,0);const o=tt(i);return e.getTime()>=n.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function Zt(s){const e=W(s);return e.setHours(0,0,0,0),e}function er(s){const e=W(s),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+s-+t}function ti(s,e){const t=Zt(s),r=Zt(e),n=+t-er(t),i=+r-er(r);return Math.round((n-i)/Za)}function ri(s){const e=Vr(s),t=ce(s,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),tt(t)}function tr(s,e){const t=e*7;return Ue(s,t)}function si(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function ni(s){if(!si(s)&&typeof s!="number")return!1;const e=W(s);return!isNaN(Number(e))}function ai(s){const e=W(s),t=ce(s,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}function Xe(s,e){var c,l,u,d;const t=ze(),r=(e==null?void 0:e.weekStartsOn)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??t.weekStartsOn??((d=(u=t.locale)==null?void 0:u.options)==null?void 0:d.weekStartsOn)??0,n=W(s),i=n.getDay(),o=(i<r?-7:0)+6-(i-r);return n.setDate(n.getDate()+o),n.setHours(23,59,59,999),n}const ii={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},oi=(s,e,t)=>{let r;const n=ii[s];return typeof n=="string"?r=n:e===1?r=n.one:r=n.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function pt(s){return(e={})=>{const t=e.width?String(e.width):s.defaultWidth;return s.formats[t]||s.formats[s.defaultWidth]}}const ci={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},li={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},di={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ui={date:pt({formats:ci,defaultWidth:"full"}),time:pt({formats:li,defaultWidth:"full"}),dateTime:pt({formats:di,defaultWidth:"full"})},hi={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},fi=(s,e,t,r)=>hi[s];function Oe(s){return(e,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let n;if(r==="formatting"&&s.formattingValues){const o=s.defaultFormattingWidth||s.defaultWidth,c=t!=null&&t.width?String(t.width):o;n=s.formattingValues[c]||s.formattingValues[o]}else{const o=s.defaultWidth,c=t!=null&&t.width?String(t.width):s.defaultWidth;n=s.values[c]||s.values[o]}const i=s.argumentCallback?s.argumentCallback(e):e;return n[i]}}const mi={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},gi={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},pi={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},yi={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},xi={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},wi={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},bi=(s,e)=>{const t=Number(s),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},vi={ordinalNumber:bi,era:Oe({values:mi,defaultWidth:"wide"}),quarter:Oe({values:gi,defaultWidth:"wide",argumentCallback:s=>s-1}),month:Oe({values:pi,defaultWidth:"wide"}),day:Oe({values:yi,defaultWidth:"wide"}),dayPeriod:Oe({values:xi,defaultWidth:"wide",formattingValues:wi,defaultFormattingWidth:"wide"})};function De(s){return(e,t={})=>{const r=t.width,n=r&&s.matchPatterns[r]||s.matchPatterns[s.defaultMatchWidth],i=e.match(n);if(!i)return null;const o=i[0],c=r&&s.parsePatterns[r]||s.parsePatterns[s.defaultParseWidth],l=Array.isArray(c)?ki(c,h=>h.test(o)):_i(c,h=>h.test(o));let u;u=s.valueCallback?s.valueCallback(l):l,u=t.valueCallback?t.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function _i(s,e){for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&e(s[t]))return t}function ki(s,e){for(let t=0;t<s.length;t++)if(e(s[t]))return t}function ji(s){return(e,t={})=>{const r=e.match(s.matchPattern);if(!r)return null;const n=r[0],i=e.match(s.parsePattern);if(!i)return null;let o=s.valueCallback?s.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const c=e.slice(n.length);return{value:o,rest:c}}}const Si=/^(\d+)(th|st|nd|rd)?/i,Ni=/\d+/i,Ei={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ci={any:[/^b/i,/^(a|c)/i]},Pi={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ti={any:[/1/i,/2/i,/3/i,/4/i]},Oi={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Di={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$i={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ai={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Mi={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ri={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Li={ordinalNumber:ji({matchPattern:Si,parsePattern:Ni,valueCallback:s=>parseInt(s,10)}),era:De({matchPatterns:Ei,defaultMatchWidth:"wide",parsePatterns:Ci,defaultParseWidth:"any"}),quarter:De({matchPatterns:Pi,defaultMatchWidth:"wide",parsePatterns:Ti,defaultParseWidth:"any",valueCallback:s=>s+1}),month:De({matchPatterns:Oi,defaultMatchWidth:"wide",parsePatterns:Di,defaultParseWidth:"any"}),day:De({matchPatterns:$i,defaultMatchWidth:"wide",parsePatterns:Ai,defaultParseWidth:"any"}),dayPeriod:De({matchPatterns:Mi,defaultMatchWidth:"any",parsePatterns:Ri,defaultParseWidth:"any"})},Ii={code:"en-US",formatDistance:oi,formatLong:ui,formatRelative:fi,localize:vi,match:Li,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ui(s){const e=W(s);return ti(e,ai(e))+1}function Fi(s){const e=W(s),t=+tt(e)-+ri(e);return Math.round(t/Hr)+1}function Yr(s,e){var d,h,f,g;const t=W(s),r=t.getFullYear(),n=ze(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((g=(f=n.locale)==null?void 0:f.options)==null?void 0:g.firstWeekContainsDate)??1,o=ce(s,0);o.setFullYear(r+1,0,i),o.setHours(0,0,0,0);const c=pe(o,e),l=ce(s,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);const u=pe(l,e);return t.getTime()>=c.getTime()?r+1:t.getTime()>=u.getTime()?r:r-1}function Wi(s,e){var c,l,u,d;const t=ze(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.firstWeekContainsDate)??t.firstWeekContainsDate??((d=(u=t.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,n=Yr(s,e),i=ce(s,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),pe(i,e)}function qi(s,e){const t=W(s),r=+pe(t,e)-+Wi(t,e);return Math.round(r/Hr)+1}function R(s,e){const t=s<0?"-":"",r=Math.abs(s).toString().padStart(e,"0");return t+r}const se={y(s,e){const t=s.getFullYear(),r=t>0?t:1-t;return R(e==="yy"?r%100:r,e.length)},M(s,e){const t=s.getMonth();return e==="M"?String(t+1):R(t+1,2)},d(s,e){return R(s.getDate(),e.length)},a(s,e){const t=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(s,e){return R(s.getHours()%12||12,e.length)},H(s,e){return R(s.getHours(),e.length)},m(s,e){return R(s.getMinutes(),e.length)},s(s,e){return R(s.getSeconds(),e.length)},S(s,e){const t=e.length,r=s.getMilliseconds(),n=Math.trunc(r*Math.pow(10,t-3));return R(n,e.length)}},_e={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},rr={G:function(s,e,t){const r=s.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(s,e,t){if(e==="yo"){const r=s.getFullYear(),n=r>0?r:1-r;return t.ordinalNumber(n,{unit:"year"})}return se.y(s,e)},Y:function(s,e,t,r){const n=Yr(s,r),i=n>0?n:1-n;if(e==="YY"){const o=i%100;return R(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):R(i,e.length)},R:function(s,e){const t=Vr(s);return R(t,e.length)},u:function(s,e){const t=s.getFullYear();return R(t,e.length)},Q:function(s,e,t){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return R(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(s,e,t){const r=Math.ceil((s.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return R(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(s,e,t){const r=s.getMonth();switch(e){case"M":case"MM":return se.M(s,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(s,e,t){const r=s.getMonth();switch(e){case"L":return String(r+1);case"LL":return R(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(s,e,t,r){const n=qi(s,r);return e==="wo"?t.ordinalNumber(n,{unit:"week"}):R(n,e.length)},I:function(s,e,t){const r=Fi(s);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):R(r,e.length)},d:function(s,e,t){return e==="do"?t.ordinalNumber(s.getDate(),{unit:"date"}):se.d(s,e)},D:function(s,e,t){const r=Ui(s);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):R(r,e.length)},E:function(s,e,t){const r=s.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(s,e,t,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return R(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(n,{width:"short",context:"formatting"});case"eeee":default:return t.day(n,{width:"wide",context:"formatting"})}},c:function(s,e,t,r){const n=s.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return R(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(n,{width:"narrow",context:"standalone"});case"cccccc":return t.day(n,{width:"short",context:"standalone"});case"cccc":default:return t.day(n,{width:"wide",context:"standalone"})}},i:function(s,e,t){const r=s.getDay(),n=r===0?7:r;switch(e){case"i":return String(n);case"ii":return R(n,e.length);case"io":return t.ordinalNumber(n,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(s,e,t){const n=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(s,e,t){const r=s.getHours();let n;switch(r===12?n=_e.noon:r===0?n=_e.midnight:n=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(s,e,t){const r=s.getHours();let n;switch(r>=17?n=_e.evening:r>=12?n=_e.afternoon:r>=4?n=_e.morning:n=_e.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(s,e,t){if(e==="ho"){let r=s.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return se.h(s,e)},H:function(s,e,t){return e==="Ho"?t.ordinalNumber(s.getHours(),{unit:"hour"}):se.H(s,e)},K:function(s,e,t){const r=s.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):R(r,e.length)},k:function(s,e,t){let r=s.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):R(r,e.length)},m:function(s,e,t){return e==="mo"?t.ordinalNumber(s.getMinutes(),{unit:"minute"}):se.m(s,e)},s:function(s,e,t){return e==="so"?t.ordinalNumber(s.getSeconds(),{unit:"second"}):se.s(s,e)},S:function(s,e){return se.S(s,e)},X:function(s,e,t){const r=s.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return nr(r);case"XXXX":case"XX":return fe(r);case"XXXXX":case"XXX":default:return fe(r,":")}},x:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"x":return nr(r);case"xxxx":case"xx":return fe(r);case"xxxxx":case"xxx":default:return fe(r,":")}},O:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+sr(r,":");case"OOOO":default:return"GMT"+fe(r,":")}},z:function(s,e,t){const r=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+sr(r,":");case"zzzz":default:return"GMT"+fe(r,":")}},t:function(s,e,t){const r=Math.trunc(s.getTime()/1e3);return R(r,e.length)},T:function(s,e,t){const r=s.getTime();return R(r,e.length)}};function sr(s,e=""){const t=s>0?"-":"+",r=Math.abs(s),n=Math.trunc(r/60),i=r%60;return i===0?t+String(n):t+String(n)+e+R(i,2)}function nr(s,e){return s%60===0?(s>0?"-":"+")+R(Math.abs(s)/60,2):fe(s,e)}function fe(s,e=""){const t=s>0?"-":"+",r=Math.abs(s),n=R(Math.trunc(r/60),2),i=R(r%60,2);return t+n+e+i}const ar=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Gr=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Bi=(s,e)=>{const t=s.match(/(P+)(p+)?/)||[],r=t[1],n=t[2];if(!n)return ar(s,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",ar(r,e)).replace("{{time}}",Gr(n,e))},Hi={p:Gr,P:Bi},zi=/^D+$/,Ji=/^Y+$/,Vi=["D","DD","YY","YYYY"];function Yi(s){return zi.test(s)}function Gi(s){return Ji.test(s)}function Ki(s,e,t){const r=Qi(s,e,t);if(console.warn(r),Vi.includes(s))throw new RangeError(r)}function Qi(s,e,t){const r=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Xi=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Zi=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,eo=/^'([^]*?)'?$/,to=/''/g,ro=/[a-zA-Z]/;function q(s,e,t){var d,h,f,g;const r=ze(),n=r.locale??Ii,i=r.firstWeekContainsDate??((h=(d=r.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??1,o=r.weekStartsOn??((g=(f=r.locale)==null?void 0:f.options)==null?void 0:g.weekStartsOn)??0,c=W(s);if(!ni(c))throw new RangeError("Invalid time value");let l=e.match(Zi).map(x=>{const p=x[0];if(p==="p"||p==="P"){const w=Hi[p];return w(x,n.formatLong)}return x}).join("").match(Xi).map(x=>{if(x==="''")return{isToken:!1,value:"'"};const p=x[0];if(p==="'")return{isToken:!1,value:so(x)};if(rr[p])return{isToken:!0,value:x};if(p.match(ro))throw new RangeError("Format string contains an unescaped latin alphabet character `"+p+"`");return{isToken:!1,value:x}});n.localize.preprocessor&&(l=n.localize.preprocessor(c,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:n};return l.map(x=>{if(!x.isToken)return x.value;const p=x.value;(Gi(p)||Yi(p))&&Ki(p,e,String(s));const w=rr[p[0]];return w(c,p,n.localize,u)}).join("")}function so(s){const e=s.match(eo);return e?e[1].replace(to,"'"):s}function ir(s,e){const t=+W(s),[r,n]=[+W(e.start),+W(e.end)].sort((i,o)=>i-o);return t>=r&&t<=n}function Kr(s,e){return Ue(s,-e)}function At(s,e){const r=oo(s);let n;if(r.date){const l=co(r.date,2);n=lo(l.restDateString,l.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const i=n.getTime();let o=0,c;if(r.time&&(o=uo(r.time),isNaN(o)))return new Date(NaN);if(r.timezone){if(c=ho(r.timezone),isNaN(c))return new Date(NaN)}else{const l=new Date(i+o),u=new Date(0);return u.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),u.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),u}return new Date(i+o+c)}const Qe={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},no=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ao=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,io=/^([+-])(\d{2})(?::?(\d{2}))?$/;function oo(s){const e={},t=s.split(Qe.dateTimeDelimiter);let r;if(t.length>2)return e;if(/:/.test(t[0])?r=t[0]:(e.date=t[0],r=t[1],Qe.timeZoneDelimiter.test(e.date)&&(e.date=s.split(Qe.timeZoneDelimiter)[0],r=s.substr(e.date.length,s.length))),r){const n=Qe.timezone.exec(r);n?(e.time=r.replace(n[1],""),e.timezone=n[1]):e.time=r}return e}function co(s,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=s.match(t);if(!r)return{year:NaN,restDateString:""};const n=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?n:i*100,restDateString:s.slice((r[1]||r[2]).length)}}function lo(s,e){if(e===null)return new Date(NaN);const t=s.match(no);if(!t)return new Date(NaN);const r=!!t[4],n=$e(t[1]),i=$e(t[2])-1,o=$e(t[3]),c=$e(t[4]),l=$e(t[5])-1;if(r)return yo(e,c,l)?fo(e,c,l):new Date(NaN);{const u=new Date(0);return!go(e,i,o)||!po(e,n)?new Date(NaN):(u.setUTCFullYear(e,i,Math.max(n,o)),u)}}function $e(s){return s?parseInt(s):1}function uo(s){const e=s.match(ao);if(!e)return NaN;const t=yt(e[1]),r=yt(e[2]),n=yt(e[3]);return xo(t,r,n)?t*Jr+r*zr+n*1e3:NaN}function yt(s){return s&&parseFloat(s.replace(",","."))||0}function ho(s){if(s==="Z")return 0;const e=s.match(io);if(!e)return 0;const t=e[1]==="+"?-1:1,r=parseInt(e[2]),n=e[3]&&parseInt(e[3])||0;return wo(r,n)?t*(r*Jr+n*zr):NaN}function fo(s,e,t){const r=new Date(0);r.setUTCFullYear(s,0,4);const n=r.getUTCDay()||7,i=(e-1)*7+t+1-n;return r.setUTCDate(r.getUTCDate()+i),r}const mo=[31,null,31,30,31,30,31,31,30,31,30,31];function Qr(s){return s%400===0||s%4===0&&s%100!==0}function go(s,e,t){return e>=0&&e<=11&&t>=1&&t<=(mo[e]||(Qr(s)?29:28))}function po(s,e){return e>=1&&e<=(Qr(s)?366:365)}function yo(s,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function xo(s,e,t){return s===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&s>=0&&s<25}function wo(s,e){return e>=0&&e<=59}function or(s,e){const t=W(s);return t.setHours(e),t}function cr(s,e){const t=W(s);return t.setMilliseconds(e),t}function lr(s,e){const t=W(s);return t.setMinutes(e),t}function dr(s,e){const t=W(s);return t.setSeconds(e),t}function bo({selectedDate:s,onChange:e}){const t=()=>{e(Ue(s,-1))},r=()=>{e(Ue(s,1))},n=()=>{e(new Date)};return a.jsxs("div",{className:"flex items-center justify-between mb-4 p-4 rounded-lg bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 shadow-md transition-all duration-300",children:[a.jsx("button",{onClick:t,className:"p-2 hover:dark:bg-gray-700 rounded-full","aria-label":"Previous day",children:a.jsx(La,{className:"h-5 w-5 dark:text-gray-300"})}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-lg font-medium dark:text-gray-100",children:q(s,"EEEE, MMMM d, yyyy")}),a.jsx("button",{onClick:n,className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"Today"})]}),a.jsx("button",{onClick:r,className:"p-2 hover:dark:bg-gray-700 rounded-full","aria-label":"Next day",children:a.jsx(Ia,{className:"h-5 w-5 dark:text-gray-300"})})]})}function Q(){return a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})})}function vo({completedExercises:s}){const{user:e}=J(),[t,r]=m.useState([]),[n,i]=m.useState(s||[]),[o,c]=m.useState(!0),[l,u]=m.useState(pe(new Date,{weekStartsOn:1}));m.useEffect(()=>{async function g(){c(!0);try{const{data:x,error:p}=await _.from("exercises").select("*").order("name");if(p)throw p;if(r(x||[]),e){const w=q(l,"yyyy-MM-dd"),v=q(Xe(l,{weekStartsOn:1}),"yyyy-MM-dd");console.log("Fetching completed exercises between:",w,"and",v);const{data:y,error:k}=await _.from("workout_logs").select(`
              completed_at,
              workout:workouts!inner (
                workout_exercises!inner (
                  exercise_id
                )
              )
            `).eq("user_id",e.id).gte("completed_at",`${w}T00:00:00`).lte("completed_at",`${v}T23:59:59`);if(k)throw k;console.log("Completed Data:",y);const P=(y==null?void 0:y.flatMap(D=>D.workout.workout_exercises.map(F=>({exercise_id:F.exercise_id,completed_at:D.completed_at}))))||[];console.log("Formatted Exercises:",P),i(P)}}catch(x){console.error("Error fetching weekly exercises:",x)}finally{c(!1)}}g()},[e,l]),m.useEffect(()=>{s&&i(s)},[s]);const d=()=>{u(tr(l,-1))},h=()=>{u(tr(l,1))},f=g=>{const x=or(lr(dr(cr(l,0),0),0),0),p=or(lr(dr(cr(Xe(l,{weekStartsOn:1}),999),59),23),23);return console.log("Checking exercise",g,"within interval:",q(x,"yyyy-MM-dd HH:mm:ss"),"to",q(p,"yyyy-MM-dd HH:mm:ss")),n.some(w=>{const v=At(w.completed_at);return console.log("Exercise:",g,"Completed:",w.exercise_id,"Date:",q(v,"yyyy-MM-dd HH:mm:ss"),"In range?",ir(v,{start:x,end:p})),w.exercise_id===g&&ir(v,{start:x,end:p})})};return o?a.jsx(Q,{}):a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Weekly Exercises"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full","aria-label":"Previous week",children:"<"}),a.jsxs("span",{className:"text-sm dark:text-gray-300",children:[q(l,"MMM d")," - ",q(Xe(l,{weekStartsOn:1}),"MMM d")]}),a.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full","aria-label":"Next week",children:">"})]})]}),a.jsx("ul",{className:"space-y-2",children:t.map(g=>a.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsx("span",{className:"dark:text-white",children:g.name}),f(g.id)?a.jsx(Ra,{className:"h-5 w-5 text-green-500"}):a.jsx(Ua,{className:"h-5 w-5 text-gray-400"})]},g.id))})]})}function _o({}){const{user:s}=J(),[e,t]=m.useState([]),[r,n]=m.useState(!0);return m.useEffect(()=>{async function i(){if(s){n(!0);try{const o=Kr(new Date,7).toISOString(),{data:c,error:l}=await _.from("workout_logs").select(`
            *,
            workout:workouts (*)
          `).eq("user_id",s.id).gte("completed_at",o).order("completed_at",{ascending:!1}).limit(5);if(l){console.error("Error fetching recent workouts:",l);return}t(c)}finally{n(!1)}}}i()},[s]),a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-2xl font-bold dark:text-gray-100 mb-4",children:"Recent Workouts (Last 7 Days)"}),r?a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."}):e.length===0?a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No workouts found."}):a.jsx("div",{className:"space-y-4",children:e.map(i=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:i.workout.name}),a.jsx("p",{className:"text-sm dark:text-gray-300",children:q(new Date(i.completed_at),"PPP")})]}),a.jsxs("span",{className:"text-indigo-600 font-medium",children:["Score: ",i.total]})]},i.id))})]})}function ko(s){const{user:e}=J(),[t,r]=m.useState(null),[n,i]=m.useState(!0);return m.useEffect(()=>{async function o(){if(!(!e||!s))try{const{data:c,error:l}=await _.from("exercise_scores").select("weight").eq("user_id",e.id).eq("exercise_id",s).order("weight",{ascending:!1}).limit(1);if(l)throw l;if(c&&c.length>0){const u=c[0].weight,d=[100,90,80,70,60,50].map(h=>({percentage:h,weight:Math.round(u*h/100*2)/2}));r({maxWeight:u,percentages:d})}}catch(c){console.error("Error fetching exercise history:",c)}finally{i(!1)}}o()},[e,s]),{history:t,loading:n}}function Xr({exerciseId:s,exerciseName:e}){const{history:t,loading:r}=ko(s);return r||!t?null:a.jsxs("div",{className:"mt-2 dark:bg-gray-800 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(He,{className:"h-4 w-4 text-yellow-500"}),a.jsxs("span",{className:"text-sm font-medium",children:["Personal Best: ",t.maxWeight,"lbs"]})]}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:t.percentages.map(({percentage:n,weight:i})=>a.jsxs("div",{className:"bg-white rounded p-2 text-center shadow-sm dark:bg-gray-700",children:[a.jsxs("div",{className:"text-sm font-medium text-indigo-600",children:[n,"%"]}),a.jsxs("div",{className:"text-sm dark:text-gray-300",children:[i,"lbs"]})]},n))})]})}const z=[];for(let s=0;s<256;++s)z.push((s+256).toString(16).slice(1));function jo(s,e=0){return(z[s[e+0]]+z[s[e+1]]+z[s[e+2]]+z[s[e+3]]+"-"+z[s[e+4]]+z[s[e+5]]+"-"+z[s[e+6]]+z[s[e+7]]+"-"+z[s[e+8]]+z[s[e+9]]+"-"+z[s[e+10]]+z[s[e+11]]+z[s[e+12]]+z[s[e+13]]+z[s[e+14]]+z[s[e+15]]).toLowerCase()}let xt;const So=new Uint8Array(16);function No(){if(!xt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");xt=crypto.getRandomValues.bind(crypto)}return xt(So)}const Eo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ur={randomUUID:Eo};function Fe(s,e,t){var n;if(ur.randomUUID&&!s)return ur.randomUUID();s=s||{};const r=s.random??((n=s.rng)==null?void 0:n.call(s))??No();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,jo(r)}function Zr({workout:s,onClose:e,previousLogs:t,workoutLogId:r,isCompleted:n}){var V;const{user:i}=J(),[o,c]=m.useState([]),[l,u]=m.useState(""),[d,h]=m.useState(!1),[f,g]=m.useState(r),[x,p]=m.useState([]);m.useEffect(()=>{(async()=>{var N;if(!i)return;let j=[],E=[];if(r){g(r);try{const{data:C,error:b}=await _.from("exercise_scores").select("*").eq("workout_log_id",r).eq("user_id",i.id);if(b)throw b;E=C||[]}catch(C){console.error("Error fetching previous exercise scores:",C)}}else if(t&&t.length>0){const C=t[0];u(C.notes||""),g(C.id);try{const{data:b,error:S}=await _.from("exercise_scores").select("*").eq("workout_log_id",C.id).eq("user_id",i.id);if(S)throw S;E=b||[]}catch(b){console.error("Error fetching previous exercise scores:",b)}}j=((N=s.workout_exercises)==null?void 0:N.map(C=>{const S=E.filter(T=>T.exercise_id===C.exercise_id).map(T=>({id:T.id,weight:T.weight||0,reps:T.reps,distance:T.distance,time:w(T.time),calories:T.calories}));return S.length===0?{exercise_id:C.exercise_id,sets:Array(C.sets).fill({weight:null,reps:C.reps,distance:C.distance,time:w(C.time),calories:C.calories})}:{exercise_id:C.exercise_id,sets:S}}))||[],c(j),p(E)})()},[t,s,i,r]);const w=O=>{if(O==null)return"00:00";if(typeof O=="number"){const j=Math.floor(O),E=Math.floor(j/60),N=j%60;return`${String(E).padStart(2,"0")}:${String(N).padStart(2,"0")}`}return O},v=(O,j,E,N)=>{c(C=>{const b=[...C];return b[O].sets[j]={...b[O].sets[j],[E]:E==="time"?N:Number(N)},b})},y=O=>{c(j=>{var C;const E=[...j],N=(C=s.workout_exercises)==null?void 0:C[O];return N&&(E[O]={...E[O],sets:[...E[O].sets,{id:Fe(),weight:null,reps:N.reps,distance:N.distance,time:w(N.time),calories:N.calories}]}),E})},k=(O,j)=>{c(E=>{const N=[...E];return N[O].sets=N[O].sets.filter((C,b)=>b!==j),N})},P=(O,j,E)=>{if(O.exercise.name==="Run")return j.sets.reduce((N,C)=>N+(C.distance||0),0);if(O.exercise.name==="Assault Bike")return j.sets.reduce((N,C)=>N+(C.calories||0),0);if(E==="weight training"){let N=0;return j.sets.forEach(C=>{C.weight>N&&(N=C.weight)}),N}else{let N=0;return j.sets.forEach(C=>{C.weight>N&&(N=C.weight)}),N}},D=(O,j)=>O.exercise.name==="Run"?j.sets.reduce((E,N)=>E+(N.distance||0),0):O.exercise.name==="Assault Bike"?j.sets.reduce((E,N)=>E+(N.calories||0),0):j.sets.reduce((E,N)=>E+N.weight*N.reps,0),F=()=>{e()},L=async()=>{if(!i){alert("User is not logged in.");return}h(!0);try{const O=o.reduce((b,S,T)=>{var H;const A=(H=s.workout_exercises)==null?void 0:H[T];return b+(A?P(A,S,s.type):0)},0),j=o.reduce((b,S,T)=>{var H;const A=(H=s.workout_exercises)==null?void 0:H[T];return b+(A?D(A,S):0)},0);let E=f;if(E){const{data:b,error:S}=await _.from("workout_logs").update({notes:l,score:O,total:j,completed_at:new Date().toISOString()}).eq("id",E).select().maybeSingle();if(S)throw console.error("Error updating workout log:",S),S;if(!b){console.warn("No workout log found with that ID to update.");const{data:T,error:A}=await _.from("workout_logs").insert({user_id:i.id,workout_id:s.id,notes:l,completed_at:new Date().toISOString(),score:O,total:j}).select().maybeSingle();if(A)throw console.error("Error creating workout log after failed update:",A),A;if(!T)throw console.error("Failed to create new workout log after failed update"),new Error("Failed to create or update workout log");E=T.id,g(E)}}else{const{data:b,error:S}=await _.from("workout_logs").insert({user_id:i.id,workout_id:s.id,notes:l,completed_at:new Date().toISOString(),score:O,total:j}).select().maybeSingle();if(S)throw console.error("Error creating workout log:",S),S;if(!b)throw console.warn("Workout log creation returned no data."),new Error("Failed to create workout log");E=b.id,g(E)}if(!E)throw new Error("Missing workout log ID");const N=o.flatMap((b,S)=>{var A;return((A=s.workout_exercises)==null?void 0:A[S])?b.sets.map(H=>({id:H.id||Fe(),user_id:i.id,workout_log_id:E,exercise_id:b.exercise_id,weight:H.weight,reps:H.reps,distance:H.distance,time:H.time,calories:H.calories})):[]}),{error:C}=await _.from("exercise_scores").upsert(N,{onConflict:"id"});if(C)throw console.error("Error upserting exercise scores:",C),C;if(E){const b=x.map(A=>A.id),S=N.map(A=>A.id).filter(A=>A),T=b.filter(A=>!S.includes(A));if(T.length>0){const{error:A}=await _.from("exercise_scores").delete().in("id",T);if(A)throw A}}if(i){const b=q(pe(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),S=q(Xe(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),{data:T,error:A}=await _.from("workout_logs").select(`
            completed_at,
            workout:workouts!inner (
              workout_exercises!inner (
                exercise_id
              )
            )
          `).eq("user_id",i.id).gte("completed_at",b).lte("completed_at",S);if(A)throw A;const H=(T==null?void 0:T.flatMap(Pe=>Pe.workout.workout_exercises.map(Je=>({exercise_id:Je.exercise_id,completed_at:Pe.completed_at}))))||[];e(H)}else e();alert("Workout logged successfully!")}catch(O){console.error("Error logging workout:",O),alert(`Failed to log workout: ${O.message||"Unknown error"}`)}finally{h(!1)}};return a.jsx("div",{className:"fixed inset-0 dark:bg-gray-800 bg-opacity-75 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 ai-style-change-1 dark:bg-gray-700 dark:text-gray-300 dark:shadow-gray-900",children:[a.jsxs("h2",{className:"text-2xl font-bold dark:text-gray-100 mb-6",children:["Log Workout: ",s.name]}),a.jsxs("div",{className:"space-y-6",children:[(V=s.workout_exercises)==null?void 0:V.map((O,j)=>{var E,N;return a.jsxs("div",{className:"border rounded-md p-4",children:[a.jsx("h3",{className:"font-medium text-lg mb-3",children:O.exercise.name}),a.jsx(Xr,{exerciseId:O.exercise_id,exerciseName:O.exercise.name}),a.jsxs("div",{className:"space-y-3 mt-4",children:[Array.from({length:((N=(E=o[j])==null?void 0:E.sets)==null?void 0:N.length)||0}).map((C,b)=>a.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[a.jsxs("div",{className:"text-sm text-gray-500",children:["Set ",b+1]}),O.exercise.name==="Run"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Time (HH:MM)"}),a.jsx("input",{type:"text",value:o[j].sets[b].time||"00:00",onChange:S=>v(j,b,"time",S.target.value),className:"w-full rounded-md border-gray-300",placeholder:"HH:MM"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Distance (meters)"}),a.jsx("input",{type:"number",value:o[j].sets[b].distance,onChange:S=>v(j,b,"distance",Number(S.target.value)),className:"w-full rounded-md border-gray-300",placeholder:"Distance (meters)"})]})]}):O.exercise.name==="Assault Bike"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Time (HH:MM)"}),a.jsx("input",{type:"text",value:o[j].sets[b].time||"00:00",onChange:S=>v(j,b,"time",S.target.value),className:"w-full rounded-md border-gray-300",placeholder:"HH:MM"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Calories"}),a.jsx("input",{type:"number",value:o[j].sets[b].calories,onChange:S=>v(j,b,"calories",Number(S.target.value)),className:"w-full rounded-md border-gray-300",placeholder:"Calories"})]})]}):O.exercise.name==="Rower"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Distance (meters)"}),a.jsx("input",{type:"number",value:o[j].sets[b].distance,onChange:S=>v(j,b,"distance",Number(S.target.value)),className:"w-full rounded-md border-gray-300",placeholder:"Distance (meters)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Calories"}),a.jsx("input",{type:"number",value:o[j].sets[b].calories,onChange:S=>v(j,b,"calories",Number(S.target.value)),className:"w-full rounded-md border-gray-300",placeholder:"Calories"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx("input",{type:"number",value:o[j].sets[b].weight||"",onChange:S=>v(j,b,"weight",S.target.value?Number(S.target.value):null),className:"w-full rounded-md border-gray-300",placeholder:"Weight"})}),a.jsx("div",{children:a.jsx("input",{type:"number",value:o[j].sets[b].reps,onChange:S=>v(j,b,"reps",Number(S.target.value)),className:"w-full rounded-md border-gray-300",placeholder:"Reps"})})]}),a.jsx("button",{onClick:()=>k(j,b),className:"text-red-600 hover:text-red-700",children:a.jsx(ge,{className:"h-4 w-4"})})]},b)),a.jsx("button",{onClick:()=>y(j),className:"mt-2 text-indigo-600 font-medium hover:underline",children:"Add Set"})]})]},O.id)}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300 mb-2",children:"Notes"}),a.jsx("textarea",{value:l,onChange:O=>u(O.target.value),className:"w-full rounded-md border-gray-300",rows:3})]}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx("button",{onClick:F,className:"px-4 py-2 text-sm font-medium dark:text-gray-300 hover:text-gray-500",disabled:d,children:"Cancel"}),a.jsx("button",{onClick:L,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md",disabled:d,children:d?"Saving...":n?"Update Workout":"Complete Workout"})]})]})]})})}function Co(s,e){var g;const[t,r]=m.useState(!1),[n,i]=m.useState(null),[o,c]=m.useState({name:s.name,description:s.description||"",type:s.type,is_wod:s.is_wod,scheduled_date:s.scheduled_date||new Date().toISOString().split("T")[0],exercises:((g=s.workout_exercises)==null?void 0:g.map(x=>({id:x.id,exercise_id:x.exercise_id,sets:x.sets,reps:x.reps,weight:x.weight||0})))||[],deletedExerciseIds:[]});return{formData:o,loading:t,error:n,handleChange:(x,p)=>{c(w=>({...w,[x]:p}))},handleExerciseChange:(x,p,w)=>{c(v=>({...v,exercises:v.exercises.map((y,k)=>k===x?{...y,[p]:w}:y)}))},handleSubmit:async x=>{x.preventDefault(),r(!0),i(null);try{const{error:p}=await _.from("workouts").update({name:o.name,description:o.description,type:o.type,is_wod:o.is_wod,scheduled_date:o.scheduled_date,updated_at:new Date().toISOString()}).eq("id",s.id);if(p)throw p;if(o.deletedExerciseIds.length>0){const{error:y}=await _.from("workout_exercises").delete().in("id",o.deletedExerciseIds);if(y)throw y}const w=o.exercises.map((y,k)=>({id:y.id,workout_id:s.id,exercise_id:y.exercise_id,sets:y.sets,reps:y.reps,weight:y.weight,order_index:k})),{error:v}=await _.from("workout_exercises").upsert(w,{onConflict:"id"});if(v)throw v;e()}catch(p){console.error("Error updating workout:",p),i(p)}finally{r(!1)}},addExercise:()=>{c(x=>({...x,exercises:[...x.exercises,{id:Fe(),exercise_id:"",sets:null,reps:null,weight:null}]}))},removeExercise:x=>{c(p=>{const w=p.exercises[x],v=w.id?[...p.deletedExerciseIds,w.id]:p.deletedExerciseIds;return{...p,exercises:p.exercises.filter((y,k)=>k!==x),deletedExerciseIds:v}})}}}function Po(){const[s,e]=m.useState(!1);return{deleteWorkout:async r=>{e(!0);try{const{error:n}=await _.from("workout_exercises").delete().eq("workout_id",r);if(n)throw console.error("Error deleting workout exercises:",n),n;const{error:i}=await _.from("workouts").delete().eq("id",r);if(i)throw console.error("Error deleting workout:",i),i;return!0}catch(n){throw console.error("Error deleting workout:",n),n}finally{e(!1)}},deleting:s}}function Mt(){const[s,e]=m.useState([]),[t,r]=m.useState(!0),[n,i]=m.useState(null);return m.useEffect(()=>{async function o(){r(!0),i(null);try{const{data:c,error:l}=await _.from("exercises").select("*").order("name");if(l){i("Failed to fetch exercises. Please try again."),console.error("Error fetching exercises:",l);return}e(c||[])}catch(c){console.error("Unexpected error fetching exercises:",c),i("Unexpected error occurred. Please try again.")}finally{r(!1)}}o()},[]),{exercises:s,loading:t,error:n}}function To({exercises:s,onChange:e,onAdd:t,onRemove:r}){const{exercises:n,loading:i}=Mt();return i?null:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100",children:"Exercises"}),a.jsxs("button",{type:"button",onClick:t,className:"flex items-center space-x-2 text-indigo-600 hover:text-indigo-700",children:[a.jsx(Br,{className:"h-4 w-4"}),a.jsx("span",{children:"Add Exercise"})]})]}),s.map((o,c)=>a.jsxs("div",{className:"border rounded-md p-4 space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("h4",{className:"font-medium",children:["Exercise ",c+1]}),c>0&&a.jsx("button",{type:"button",onClick:()=>r(c),className:"text-red-600 hover:text-red-700",children:a.jsx(ge,{className:"h-4 w-4"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Exercise"}),a.jsxs("select",{value:o.exercise_id,onChange:l=>e(c,"exercise_id",l.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"",children:"Select exercise"}),n.map(l=>a.jsx("option",{value:l.id,children:l.name},l.id))]})]})]},c))]})}function Oo({formData:s,onChange:e}){return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",className:"block text-sm font-medium dark:text-gray-300",children:"Workout Name"}),a.jsx("input",{type:"text",id:"name",value:s.name,onChange:t=>e("name",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium dark:text-gray-300",children:"Description"}),a.jsx("textarea",{id:"description",value:s.description,onChange:t=>e("description",t.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"type",className:"block text-sm font-medium dark:text-gray-300",children:"Workout Type"}),a.jsxs("select",{id:"type",value:s.type,onChange:t=>e("type",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"weight training",children:"Weight Training"}),a.jsx("option",{value:"cardio",children:"Cardio"}),a.jsx("option",{value:"metcon",children:"Metcon"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium dark:text-gray-300",children:"Schedule Date"}),a.jsx("input",{type:"date",id:"scheduled_date",value:s.scheduled_date,onChange:t=>e("scheduled_date",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"is_wod",checked:s.is_wod,onChange:t=>e("is_wod",t.target.checked),className:"rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),a.jsx("label",{htmlFor:"is_wod",className:"text-sm font-medium dark:text-gray-300",children:"Workout of the Day"})]})]})}function Do({onConfirm:s,onCancel:e,workoutName:t}){return a.jsx("div",{className:"fixed inset-0 dark:bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[a.jsx("div",{className:"flex items-center justify-center mb-4 text-red-600",children:a.jsx(ge,{className:"h-12 w-12"})}),a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 text-center mb-2",children:"Delete Workout"}),a.jsxs("p",{className:"text-sm text-gray-500 text-center mb-6",children:['Are you sure you want to delete "',t,'"? This action cannot be undone.']}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx("button",{onClick:e,className:"px-4 py-2 text-sm font-medium dark:text-gray-300 hover:text-gray-500",children:"Cancel"}),a.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md",children:"Delete Workout"})]})]})})}function es({workout:s,onClose:e}){const[t,r]=m.useState(!1),{deleteWorkout:n,deleting:i}=Po(),{formData:o,loading:c,handleChange:l,handleExerciseChange:u,handleSubmit:d,addExercise:h,removeExercise:f,error:g}=Co(s,e),x=async()=>{try{s&&s.id?(await n(s.id),e()):console.error("Workout ID is undefined, cannot delete.")}catch(p){console.error("Error deleting workout:",p)}};return c?a.jsx(Q,{}):a.jsxs("div",{className:"fixed inset-0 dark:bg-gray-800 bg-opacity-75 flex items-center justify-center p-4",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 ai-style-change-1 dark:bg-gray-700 dark:text-gray-300 dark:shadow-gray-900",children:[a.jsxs("div",{className:"flex justify-between items-start mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold dark:text-gray-100",children:"Edit Workout"}),a.jsx("button",{onClick:()=>r(!0),className:"text-red-600 hover:text-red-700 p-2",disabled:i,children:a.jsx(ge,{className:"h-5 w-5"})})]}),g&&a.jsxs("div",{className:"mb-4 text-sm text-red-500",children:["Error: ",g.message||"An unexpected error occurred. Please try again."]}),a.jsxs("form",{onSubmit:d,className:"space-y-6",children:[a.jsx(Oo,{formData:o,onChange:l}),a.jsx(To,{exercises:o.exercises,onChange:u,onAdd:h,onRemove:f}),a.jsxs("div",{className:"flex justify-end space-x-4",children:[a.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sm font-medium dark:text-gray-300 hover:text-gray-500",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md",children:"Save Changes"})]})]})]}),t&&a.jsx(Do,{workoutName:s.name,onConfirm:x,onCancel:()=>r(!1)})]})}function $o(){const[s,e]=m.useState(null),[t,r]=m.useState(!0),[n,i]=m.useState(new Date),[o,c]=m.useState([]),[l,u]=m.useState(0),[d,h]=m.useState([]),[f,g]=m.useState(!1),[x,p]=m.useState(!1),[w,v]=m.useState(!1),[y,k]=m.useState([]),{user:P}=J();m.useEffect(()=>{async function j(){var E;try{const N=q(n,"yyyy-MM-dd"),{data:C,error:b}=await _.from("workouts").select(`
            *,
            workout_exercises (
              *,
              exercise:exercises (*)
            )
          `).eq("is_wod",!0).eq("scheduled_date",N).limit(1);if(b)throw b;e((C==null?void 0:C[0])||null),h(((E=C==null?void 0:C[0])==null?void 0:E.workout_exercises)||[]),await D(C==null?void 0:C[0])}catch(N){console.error("Error fetching WOD:",N)}finally{r(!1)}}j()},[n,l]);const D=async j=>{if(!(!(j!=null&&j.id)||!P))try{const{data:E,error:N}=await _.from("workout_logs").select("*").eq("workout_id",j.id).eq("user_id",P.id).order("completed_at",{ascending:!1}).limit(1);if(N){console.error("Error checking workout completion:",N);return}E&&E.length>0?(v(!0),k(E)):(v(!1),k([]))}catch(E){console.error("Error checking workout completion:",E)}},F=j=>{c(j),u(E=>E+1)},L=()=>{g(!0)},V=()=>{g(!0),u(j=>j+1)},O=()=>{p(!1)};return t?a.jsx(Q,{}):a.jsxs("div",{className:"space-y-8",children:[a.jsx("h1",{className:"text-3xl font-bold dark:text-gray-100",children:"Dashboard"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx(bo,{selectedDate:n,onChange:i}),s?a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-2xl font-bold dark:text-gray-100",children:"Workout of the Day"}),a.jsx("h3",{className:"text-xl font-semibold dark:text-gray-100",children:s.name}),s.description&&a.jsx("p",{className:"dark:text-gray-300 mt-1",children:s.description}),a.jsx("div",{className:"space-y-3",children:d==null?void 0:d.map(j=>a.jsx("div",{className:"flex items-center justify-between py-2 border-t border-gray-100",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(xe,{className:"h-5 w-5 text-indigo-600 mr-3"}),a.jsx("div",{children:a.jsx("p",{className:"font-medium dark:text-gray-100",children:j.exercise.name})})]})},j.id))}),a.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[a.jsx("button",{onClick:()=>p(!0),className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"Edit"}),a.jsx("button",{onClick:w?V:L,className:`px-4 py-2 rounded-md text-white dark:bg-gray-400 bg-gray-400 ${w?"dark:bg-gray-800 hover:bg-gray-600":"bg-indigo-600 hover:bg-indigo-700"}`,children:w?"View Workout":"Start Workout"})]})]}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-2xl font-bold dark:text-gray-100",children:"Workout of the Day"}),a.jsx("p",{children:"No workout scheduled for today."})]}),a.jsx(_o,{onWorkoutComplete:F},l)]}),a.jsx("div",{className:"space-y-4",children:a.jsx(vo,{completedExercises:o})})]}),f&&a.jsx(Zr,{workout:s,onClose:()=>g(!1),previousLogs:y}),x&&a.jsx(es,{workout:s,onClose:O})]})}function Ao({profile:s}){const e=[s.first_name,s.last_name].filter(Boolean).join(" "),[t,r]=m.useState(s.avatar_url||"");return m.useEffect(()=>{r(s.avatar_url||"")},[s.avatar_url]),a.jsx("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:a.jsxs("div",{className:"flex items-start space-x-6",children:[a.jsx("div",{className:"flex-shrink-0",children:t?a.jsx("img",{src:t,alt:e,className:"h-24 w-24 rounded-full object-cover"}):a.jsx("div",{className:"h-24 w-24 rounded-full bg-gray-200 flex items-center justify-center",children:a.jsx($t,{className:"h-12 w-12 text-gray-400"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold dark:text-gray-100",children:e}),s.profile_name&&a.jsxs("p",{className:"text-gray-500",children:["@",s.profile_name]})]})}),a.jsxs("div",{className:"mt-4 flex items-center space-x-4 text-gray-500",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ha,{className:"h-4 w-4 mr-1"}),a.jsx("span",{children:s.email})]}),s.age&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(Be,{className:"h-4 w-4 mr-1"}),a.jsxs("span",{children:[s.age," years old"]})]}),s.gender&&a.jsx("div",{className:"px-2 py-1 rounded-full dark:bg-gray-700 text-sm",children:s.gender})]})]})]})})}function Mo(){const{user:s}=J(),[e,t]=m.useState({personalRecords:0,totalWorkouts:0,currentStreak:0}),[r,n]=m.useState(!0);return m.useEffect(()=>{async function i(){if(s)try{const[o,c,l]=await Promise.all([_.from("exercise_scores").select("id",{count:"exact"}).eq("user_id",s.id),_.from("workout_logs").select("id",{count:"exact"}).eq("user_id",s.id),_.from("workout_logs").select("completed_at").eq("user_id",s.id).order("completed_at",{ascending:!1})]);let u=0;if(l.data){let h=new Date;for(const f of l.data){const g=new Date(f.completed_at);if(g.toDateString()===h.toDateString()||g.toDateString()===new Date(h.setDate(h.getDate()-1)).toDateString())u++,h=g;else break}}t({personalRecords:o.count||0,totalWorkouts:c.count||0,currentStreak:u})}catch(o){console.error("Error fetching workout stats:",o)}finally{n(!1)}}i()},[s]),{stats:e,loading:r}}function Ro(){const{stats:s,loading:e}=Mo();return e?a.jsx(Q,{}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Statistics"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(He,{className:"h-5 w-5 text-indigo-600 mr-3"}),a.jsx("span",{className:"dark:text-gray-300",children:"Personal Records"})]}),a.jsx("span",{className:"font-semibold",children:s.personalRecords})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(xe,{className:"h-5 w-5 text-indigo-600 mr-3"}),a.jsx("span",{className:"dark:text-gray-300",children:"Total Workouts"})]}),a.jsx("span",{className:"font-semibold",children:s.totalWorkouts})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Be,{className:"h-5 w-5 text-indigo-600 mr-3"}),a.jsx("span",{className:"dark:text-gray-300",children:"Workout Streak"})]}),a.jsxs("span",{className:"font-semibold",children:[s.currentStreak," days"]})]})]})]})}function Lo({exerciseId:s}){const{user:e}=J(),[t,r]=m.useState([]),[n,i]=m.useState(!0);return m.useEffect(()=>{async function o(){if(e)try{let c=_.from("workout_logs").select(`
                *,
                workouts (
                  *
                )
              `).eq("user_id",e.id).order("completed_at",{ascending:!1}).limit(20);s&&(c=c.contains("workouts->workout_exercises->exercise_id",[s]));const{data:l,error:u}=await c;if(u)throw u;r(l||[])}catch(c){console.error("Error fetching workout history:",c)}finally{i(!1)}}o()},[e,s]),n?a.jsx(Q,{}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Workout History"}),a.jsx("div",{className:"space-y-4",children:t.map(o=>a.jsxs("div",{className:"flex items-center justify-between p-4 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium dark:text-gray-100",children:o.workouts.name}),a.jsx("p",{className:"text-sm dark:text-gray-300",children:q(new Date(o.completed_at),"PPP")}),o.notes&&a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:o.notes})]}),a.jsx("div",{className:"text-right",children:a.jsxs("span",{className:"text-indigo-600 font-medium",children:["Score: ",o.score]})})]},o.id))})]})}function ts(){const{user:s}=J(),[e,t]=m.useState(null),[r,n]=m.useState(!0);return m.useEffect(()=>{async function i(){if(s)try{const{data:o,error:c}=await _.from("profiles").select("*").eq("id",s.id).single();if(c)throw c;t(o)}catch(o){console.error("Error fetching profile:",o)}finally{n(!1)}}i()},[s]),{profile:e,loading:r}}function Io(){var o;const{profile:s,loading:e}=ts(),{exercises:t,loading:r}=Mt(),[n,i]=m.useState(null);return e||r?a.jsx(Q,{}):s?a.jsxs("div",{className:"space-y-8",children:[a.jsx(Ao,{profile:s}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"exerciseSelect",className:"block text-sm font-medium dark:text-gray-300",children:"Select Exercise"}),a.jsxs("select",{id:"exerciseSelect",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",onChange:c=>i(c.target.value),value:n||"",children:[a.jsx("option",{value:"",children:"Select an exercise"}),t.map(c=>a.jsx("option",{value:c.id,children:c.name},c.id))]})]}),n&&a.jsx(Xr,{exerciseId:n,exerciseName:((o=t.find(c=>c.id===n))==null?void 0:o.name)||""}),a.jsx(Lo,{exerciseId:n})]}),a.jsx("div",{children:a.jsx(Ro,{})})]})]}):null}function Uo(){const{profile:s,loading:e}=ts(),[t,r]=m.useState(!1),[n,i]=m.useState(""),[o,c]=m.useState({first_name:"",last_name:"",profile_name:"",birthday:"",gender:"",avatar_url:""});fr.useEffect(()=>{s&&c({first_name:s.first_name||"",last_name:s.last_name||"",profile_name:s.profile_name||"",birthday:s.birthday||"",gender:s.gender||"",avatar_url:s.avatar_url||""})},[s]);const l=async d=>{if(d.preventDefault(),!!s){r(!0),i("");try{const{error:h}=await _.from("profiles").update({first_name:o.first_name||null,last_name:o.last_name||null,profile_name:o.profile_name||null,birthday:o.birthday||null,gender:o.gender||null,avatar_url:o.avatar_url||null,updated_at:new Date().toISOString()}).eq("id",s.id);if(h)throw h;i("Profile updated successfully")}catch(h){console.error("Error updating profile:",h),i("Error updating profile")}finally{r(!1)}}},u=async d=>{var f;const h=(f=d.target.files)==null?void 0:f[0];if(h){r(!0),i("");try{const{data:g,error:x}=await _.storage.from("primalphotos").upload(`avatars/${s.id}/${h.name}`,h,{cacheControl:"3600",upsert:!1});if(x)throw x;const p=_.storage.from("primalphotos").getPublicUrl(g.path);c(w=>({...w,avatar_url:p.data.publicUrl})),i("Avatar uploaded successfully")}catch(g){console.error("Error uploading avatar:",g),i("Error uploading avatar")}finally{r(!1)}}};return e?a.jsx(Q,{}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Profile Settings"}),a.jsxs("form",{onSubmit:l,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium dark:text-gray-300",children:"First Name"}),a.jsx("input",{type:"text",id:"first_name",value:o.first_name,onChange:d=>c(h=>({...h,first_name:d.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium dark:text-gray-300",children:"Last Name"}),a.jsx("input",{type:"text",id:"last_name",value:o.last_name,onChange:d=>c(h=>({...h,last_name:d.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"profile_name",className:"block text-sm font-medium dark:text-gray-300",children:"Profile Name"}),a.jsx("input",{type:"text",id:"profile_name",value:o.profile_name,onChange:d=>c(h=>({...h,profile_name:d.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"birthday",className:"block text-sm font-medium dark:text-gray-300",children:"Birthday"}),a.jsx("input",{type:"date",id:"birthday",value:o.birthday,onChange:d=>c(h=>({...h,birthday:d.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium dark:text-gray-300",children:"Gender"}),a.jsxs("select",{id:"gender",value:o.gender,onChange:d=>c(h=>({...h,gender:d.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"",children:"Select gender"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"female",children:"Female"}),a.jsx("option",{value:"other",children:"Other"}),a.jsx("option",{value:"prefer_not_to_say",children:"Prefer not to say"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"avatar_upload",className:"block text-sm font-medium dark:text-gray-300",children:"Avatar (128x128 - 200x200)"}),a.jsx("input",{type:"file",id:"avatar_upload",accept:"image/*",onChange:u,className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"})]}),n&&a.jsx("p",{className:`text-sm ${n.includes("Error")?"text-red-600":"text-green-600"}`,children:n}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:t,className:"bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:t?"Saving...":"Save Changes"})})]})]})}function Fo(){const[s,e]=m.useState(""),[t,r]=m.useState(""),[n,i]=m.useState(""),[o,c]=m.useState(!1),[l,u]=m.useState(""),d=async h=>{if(h.preventDefault(),t!==n){u("New passwords do not match");return}c(!0),u("");try{const{error:f}=await _.auth.updateUser({password:t});if(f)throw f;u("Password updated successfully"),e(""),r(""),i("")}catch(f){console.error("Error updating password:",f),u("Error updating password")}finally{c(!1)}};return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Security Settings"}),a.jsxs("form",{onSubmit:d,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"current_password",className:"block text-sm font-medium dark:text-gray-300",children:"Current Password"}),a.jsx("input",{type:"password",id:"current_password",value:s,onChange:h=>e(h.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"new_password",className:"block text-sm font-medium dark:text-gray-300",children:"New Password"}),a.jsx("input",{type:"password",id:"new_password",value:t,onChange:h=>r(h.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"confirm_password",className:"block text-sm font-medium dark:text-gray-300",children:"Confirm New Password"}),a.jsx("input",{type:"password",id:"confirm_password",value:n,onChange:h=>i(h.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),l&&a.jsx("p",{className:`text-sm ${l.includes("Error")?"text-red-600":"text-green-600"}`,children:l}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:o,className:"bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:o?"Updating...":"Update Password"})})]})]})}function Wo(){const{user:s}=J(),[e,t]=m.useState({workout_reminders:!0,achievement_notifications:!0,leaderboard_updates:!1,message_board_notifications:!1}),[r,n]=m.useState(!1),[i,o]=m.useState("");fr.useEffect(()=>{async function l(){if(s){n(!0);try{const{data:u,error:d}=await _.from("user_preferences").select("notification_settings").eq("user_id",s.id).single();if(d)throw d;u!=null&&u.notification_settings&&t(JSON.parse(u.notification_settings))}catch(u){console.error("Error fetching notification settings:",u),o("Error fetching settings")}finally{n(!1)}}}l()},[s]);const c=async l=>{t(u=>({...u,[l]:!u[l]})),n(!0),o("");try{const{error:u}=await _.from("user_preferences").upsert({user_id:s.id,notification_settings:JSON.stringify({...e,[l]:!e[l]})},{onConflict:"user_id"});if(u)throw u;o("Settings updated successfully")}catch(u){console.error("Error updating notification settings:",u),o("Error updating settings")}finally{n(!1)}};return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Notification Settings"}),i&&a.jsx("p",{className:`mt-4 text-sm ${i.includes("Error")?"text-red-600":"text-green-600"}`,children:i}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(Ma,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:"Workout Reminders"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Get notified about your scheduled workouts"})]})]}),a.jsx("button",{onClick:()=>c("workout_reminders"),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${e.workout_reminders?"bg-indigo-600":"bg-gray-200"}`,children:a.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${e.workout_reminders?"translate-x-5":"translate-x-0"}`})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(He,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:"Achievement Notifications"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Get notified when you reach new milestones"})]})]}),a.jsx("button",{onClick:()=>c("achievement_notifications"),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${e.achievement_notifications?"bg-indigo-600":"bg-gray-200"}`,children:a.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${e.achievement_notifications?"translate-x-5":"translate-x-0"}`})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(Be,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:"Leaderboard Updates"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Get notified about leaderboard changes"})]})]}),a.jsx("button",{onClick:()=>c("leaderboard_updates"),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${e.leaderboard_updates?"bg-indigo-600":"bg-gray-200"}`,children:a.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${e.leaderboard_updates?"translate-x-5":"translate-x-0"}`})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(qr,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:"Message Board Notifications"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Get notified when new messages are posted"})]})]}),a.jsx("button",{onClick:()=>c("message_board_notifications"),className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${e.message_board_notifications?"bg-indigo-600":"bg-gray-200"}`,children:a.jsx("span",{className:`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${e.message_board_notifications?"translate-x-5":"translate-x-0"}`})})]})]})]})}function qo(){const[s,e]=m.useState(""),[t,r]=m.useState(""),[n,i]=m.useState(""),[o,c]=m.useState(""),[l,u]=m.useState("user"),[d,h]=m.useState(!1),[f,g]=m.useState(null),x=async p=>{p.preventDefault(),h(!0),g(null);try{const{data:w,error:v}=await _.auth.signUp({email:s,password:o,options:{data:{first_name:t,last_name:n}}});if(v)throw v;if(w.user){const{error:y}=await _.from("profiles").insert([{id:w.user.id,email:s,first_name:t,last_name:n,role:l}]);if(y)throw y;g({text:"User created successfully",type:"success"}),e(""),r(""),i(""),c(""),u("user")}}catch(w){console.error("Error creating user:",w),g({text:w.message||"Failed to create user",type:"error"})}finally{h(!1)}};return a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 mb-4",children:"Add New User"}),a.jsxs("form",{onSubmit:x,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium dark:text-gray-300",children:"First Name"}),a.jsx("input",{type:"text",id:"firstName",value:t,onChange:p=>r(p.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium dark:text-gray-300",children:"Last Name"}),a.jsx("input",{type:"text",id:"lastName",value:n,onChange:p=>i(p.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium dark:text-gray-300",children:"Email"}),a.jsx("input",{type:"email",id:"email",value:s,onChange:p=>e(p.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium dark:text-gray-300",children:"Password"}),a.jsx("input",{type:"password",id:"password",value:o,onChange:p=>c(p.target.value),required:!0,minLength:6,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"role",className:"block text-sm font-medium dark:text-gray-300",children:"Role"}),a.jsxs("select",{id:"role",value:l,onChange:p=>u(p.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"user",children:"User"}),a.jsx("option",{value:"admin",children:"Admin"})]})]}),f&&a.jsx("p",{className:`text-sm ${f.type==="success"?"text-green-600":"text-red-600"}`,children:f.text}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:d,className:"bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:d?"Creating...":"Create User"})})]})]})}function Bo(){const[s,e]=m.useState([]),[t,r]=m.useState(!0);return m.useEffect(()=>{async function n(){try{const{data:i,error:o}=await _.from("profiles").select("*").order("created_at",{ascending:!1});if(o)throw o;e(i||[])}catch(i){console.error("Error fetching users:",i)}finally{r(!1)}}n()},[]),t?a.jsx(Q,{}):a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 mb-4",children:"Users"}),a.jsx("div",{className:"space-y-4",children:s.map(n=>a.jsxs("div",{className:"flex items-center justify-between p-4 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:n.avatar_url?a.jsx("img",{src:n.avatar_url,alt:"",className:"h-8 w-8 rounded-full"}):a.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center",children:a.jsx($t,{className:"h-4 w-4 text-gray-500"})})}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium dark:text-gray-100",children:[n.first_name," ",n.last_name]}),a.jsx("p",{className:"text-sm text-gray-500",children:n.email})]})]}),a.jsx("span",{className:"text-sm text-gray-500",children:new Date(n.created_at).toLocaleDateString()})]},n.id))})]})}function Ho(){return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"User Management"}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(qo,{}),a.jsx(Bo,{})]})]})}function zo(){const[s,e]=m.useState(!1),[t,r]=m.useState(""),[n,i]=m.useState(""),[o,c]=m.useState(""),[l,u]=m.useState(""),[d,h]=m.useState(""),[f,g]=m.useState(""),[x,p]=m.useState([]),[w,v]=m.useState(""),[y,k]=m.useState(""),[P,D]=m.useState([]),[F,L]=m.useState("");m.useEffect(()=>{async function b(){e(!0);try{const{data:T,error:A}=await _.from("exercises").select("*").order("name");if(A)throw A;p(T||[])}catch(T){console.error("Error fetching exercises:",T)}finally{e(!1)}}async function S(){e(!0);try{const{data:T,error:A}=await _.from("messages").select("*").order("created_at");if(A)throw A;D(T||[])}catch(T){console.error("Error fetching messages:",T)}finally{e(!1)}}b(),S()},[]);const V=async b=>{var T;const S=(T=b.target.files)==null?void 0:T[0];if(S){e(!0),r("");try{const{data:A,error:H}=await _.storage.from("primalphotos").upload(`welcome/${S.name}`,S,{cacheControl:"3600",upsert:!1});if(H)throw H;const Pe=_.storage.from("primalphotos").getPublicUrl(A.path);i(Pe.data.publicUrl),r("Image uploaded successfully");const{error:Je}=await _.from("app_settings").upsert({key:"welcome_image_url",value:Pe.data.publicUrl},{onConflict:"key"});if(Je)throw Je}catch(A){console.error("Error uploading image:",A),r("Error uploading image")}finally{e(!1)}}},O=async()=>{e(!0),g("");try{const{error:b}=await _.from("exercises").insert([{name:o,description:l,category:d}]);if(b)throw b;g("Exercise created successfully"),c(""),u(""),h("");const{data:S,error:T}=await _.from("exercises").select("*").order("name");if(T)throw T;p(S||[])}catch(b){console.error("Error creating exercise:",b),g("Error creating exercise")}finally{e(!1)}},j=async()=>{e(!0),g("");try{const{error:b}=await _.from("exercises").delete().eq("id",w);if(b)throw b;g("Exercise deleted successfully");const{data:S,error:T}=await _.from("exercises").select("*").order("name");if(T)throw T;p(S||[]),v("")}catch(b){console.error("Error deleting exercise:",b),g("Error deleting exercise")}finally{e(!1)}},E=async()=>{e(!0),L("");try{const{error:b}=await _.from("messages").delete().eq("id",y);if(b)throw b;L("Message deleted successfully");const{data:S,error:T}=await _.from("messages").select("*").order("created_at");if(T)throw T;D(S||[]),k("")}catch(b){console.error("Error deleting message:",b),L("Error deleting message")}finally{e(!1)}},N=async()=>{e(!0),L("");try{const{error:b}=await _.from("messages").delete().neq("id","00000000-0000-0000-0000-000000000000");if(b)throw b;L("Message board cleared successfully");const{data:S,error:T}=await _.from("messages").select("*").order("created_at");if(T)throw T;D(S||[]),k("")}catch(b){console.error("Error clearing message board:",b),L("Error clearing message board")}finally{e(!1)}},C=["weight training","cardio","metcon"];return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Admin Settings"}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"welcome_image",className:"block text-sm font-medium dark:text-gray-300",children:"Welcome Page Image (600x400 - 800x600)"}),a.jsx("input",{type:"file",id:"welcome_image",accept:"image/*",onChange:V,className:"mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"})]}),t&&a.jsx("p",{className:`mt-4 text-sm ${t.includes("Error")?"text-red-600":"text-green-600"}`,children:t}),n&&a.jsx("div",{className:"mt-4",children:a.jsx("img",{src:n,alt:"Uploaded",className:"max-w-xs rounded-md"})}),a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 mb-4",children:"Create New Exercise"}),a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Note: Exercise names are case-sensitive."}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"new_exercise_name",className:"block text-sm font-medium dark:text-gray-300",children:"Exercise Name"}),a.jsx("input",{type:"text",id:"new_exercise_name",value:o,onChange:b=>c(b.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"new_exercise_description",className:"block text-sm font-medium dark:text-gray-300",children:"Description"}),a.jsx("textarea",{id:"new_exercise_description",value:l,onChange:b=>u(b.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"new_exercise_category",className:"block text-sm font-medium dark:text-gray-300",children:"Category"}),a.jsxs("select",{id:"new_exercise_category",value:d,onChange:b=>h(b.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"",children:"Select category"}),C.map(b=>a.jsx("option",{value:b,children:b},b))]})]}),a.jsx("button",{onClick:O,disabled:s,className:"bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:s?"Creating...":"Create Exercise"}),f&&a.jsx("p",{className:`mt-4 text-sm ${f.includes("Error")?"text-red-600":"text-green-600"}`,children:f})]})]}),a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 mb-4",children:"Current Exercises"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:w,onChange:b=>v(b.target.value),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"",children:"Select an exercise to delete"}),x.map(b=>a.jsx("option",{value:b.id,children:b.name},b.id))]}),a.jsx("button",{onClick:j,disabled:s||!w,className:"bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50",children:a.jsx(ge,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-lg font-medium dark:text-gray-100 mb-4",children:"Message Board Management"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("select",{value:y,onChange:b=>k(b.target.value),className:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[a.jsx("option",{value:"",children:"Select a message to delete"}),P.map(b=>a.jsx("option",{value:b.id,children:b.content.length>50?b.content.substring(0,50)+"...":b.content},b.id))]}),a.jsx("button",{onClick:E,disabled:s||!y,className:"bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50",children:a.jsx(ge,{className:"h-4 w-4"})})]}),a.jsx("button",{onClick:N,disabled:s,className:"mt-4 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50",children:"Clear Message Board"}),F&&a.jsx("p",{className:`mt-4 text-sm ${F.includes("Error")?"text-red-600":"text-green-600"}`,children:F})]})]})}function Jo(){return a.jsxs("div",{className:"space-y-8",children:[a.jsx("h1",{className:"text-3xl font-bold dark:text-gray-100",children:"Settings"}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(Uo,{}),a.jsx(Fo,{}),a.jsx(Wo,{}),a.jsx(Ho,{}),a.jsx(zo,{})]})]})}function Vo({workout:s,onDelete:e}){const[t,r]=m.useState(!1),[n,i]=m.useState(!1),[o,c]=m.useState([]),[l,u]=m.useState(!0),[d,h]=m.useState(!1),[f,g]=m.useState([]),[x,p]=m.useState(0),{user:w}=J(),v=async()=>{u(!0);try{const{data:L,error:V}=await _.from("workout_exercises").select(`
              *,
              exercise:exercises (*)
            `).eq("workout_id",s.id);if(V){console.error("Error fetching exercises:",V);return}c(L||[])}finally{u(!1)}},y=async()=>{if(!(!s.id||!w))try{const{data:L,error:V}=await _.from("workout_logs").select("*").eq("workout_id",s.id).eq("user_id",w.id).order("completed_at",{ascending:!1}).limit(1);if(V){console.error("Error checking workout completion:",V);return}L&&L.length>0?(h(!0),g(L)):(h(!1),g([]))}catch(L){console.error("Error checking workout completion:",L)}};m.useEffect(()=>{v(),y()},[s.id,x,w]);const k=()=>{i(!1),e()},P=()=>{r(!0)},D=()=>{r(!0),p(L=>L+1)},F=L=>{if(!L)return"";try{const V=At(L);return q(V,"PPP")}catch(V){return console.error("Error formatting date:",V),""}};return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold dark:text-gray-100 dark:text-gray-100",children:s.name}),s.description&&a.jsx("p",{className:"dark:text-gray-300 dark:text-gray-400 mt-1",children:s.description})]}),a.jsxs("div",{className:"flex items-center space-x-4 text-gray-500 dark:text-gray-400",children:[s.scheduled_date&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(Be,{className:"h-4 w-4 mr-1 dark:text-gray-400"}),a.jsx("span",{className:"text-sm dark:text-gray-300",children:F(s.scheduled_date)})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(Fa,{className:"h-4 w-4 mr-1 dark:text-gray-400"}),a.jsx("span",{className:"text-sm dark:text-gray-300",children:"~45 min"})]})]})]}),a.jsx("div",{className:"space-y-3",children:l?a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading exercises..."}):o==null?void 0:o.map(L=>a.jsx("div",{className:"flex items-center justify-between py-2 border-t border-gray-100 dark:border-gray-700",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(xe,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400 mr-3"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100 dark:text-gray-100",children:L.exercise.name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400"})]})]})},L.id))}),a.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[a.jsx("button",{onClick:()=>i(!0),className:"text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium",children:"Edit"}),a.jsx("button",{onClick:d?D:P,className:`px-4 py-2 rounded-md text-white dark:bg-gray-400 bg-gray-400 ${d?"dark:bg-gray-800 hover:bg-gray-600 dark:bg-gray-400 dark:hover:dark:bg-gray-800":"bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-400 dark:hover:bg-indigo-300"}`,children:d?"View Workout":"Start Workout"})]}),t&&a.jsx(Zr,{workout:s,onClose:()=>r(!1),previousLogs:f,workoutLogId:f.length>0?f[0].id:null}),n&&a.jsx(es,{workout:s,onClose:k})]})}function Yo({onClose:s,onCreate:e,workout:t}){var x;const{user:r}=J(),{exercises:n,loading:i,error:o}=Mt(),[c,l]=m.useState({name:"",description:"",type:"weight training",is_wod:!1,scheduled_date:q(new Date,"yyyy-MM-dd"),exercises:[]});m.useEffect(()=>{t&&l({name:t.name||"",description:t.description||"",type:t.type||"weight training",is_wod:t.is_wod||!1,scheduled_date:t.scheduled_date?q(At(t.scheduled_date),"yyyy-MM-dd"):q(new Date,"yyyy-MM-dd"),exercises:t.exercises||[]})},[t]);const u=async p=>{if(p.preventDefault(),!!r)try{let w;if(t){const{error:y}=await _.from("workouts").update({name:c.name,description:c.description,type:c.type,is_wod:c.is_wod,scheduled_date:c.scheduled_date}).eq("id",t.id);if(y)throw y;w=t.id}else{const{data:y,error:k}=await _.from("workouts").insert([{name:c.name,description:c.description,type:c.type,is_wod:c.is_wod,scheduled_date:c.scheduled_date,created_by:r.id}]).select().single();if(k)throw k;w=y.id,e&&e(y)}const v=c.exercises.map((y,k)=>({id:Fe(),workout_id:w,exercise_id:y.exercise_id,sets:y.sets,reps:y.reps,weight:y.weight,distance:y.distance,time:y.time,order_index:k}));if(v.length>0){const{error:y}=await _.from("workout_exercises").insert(v);if(y)throw y}s()}catch(w){console.error("Error saving workout:",w)}},d=p=>{const{name:w,value:v,type:y,checked:k}=p.target;l({...c,[w]:y==="checkbox"?k:v,scheduled_date:w==="scheduled_date"?v:c.scheduled_date})},h=(p,w,v)=>{const y=[...c.exercises];y[p]={...y[p],[w]:v},l({...c,exercises:y})},f=()=>{l({...c,exercises:[...c.exercises,{id:Fe(),exercise_id:"",sets:null,reps:null,weight:null}]})},g=p=>{const w=c.exercises.filter((v,y)=>y!==p);l({...c,exercises:w})};return i?a.jsx("div",{children:"Loading exercises..."}):o?a.jsxs("div",{children:["Error loading exercises: ",o.message]}):a.jsxs("form",{onSubmit:u,className:"space-y-6 p-6 bg-white dark:bg-gray-800 shadow-lg rounded-lg",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Name"}),a.jsx("input",{type:"text",name:"name",value:c.name,onChange:d,required:!0,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Description"}),a.jsx("textarea",{name:"description",value:c.description,onChange:d,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Type"}),a.jsxs("select",{name:"type",value:c.type,onChange:d,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[a.jsx("option",{value:"weight training",children:"Weight Training"}),a.jsx("option",{value:"cardio",children:"Cardio"}),a.jsx("option",{value:"metcon",children:"Metcon"})]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",name:"is_wod",checked:c.is_wod,onChange:d,className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),a.jsx("label",{className:"ml-2 block text-sm font-medium dark:text-gray-300",children:"Is Workout of the Day"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Schedule Date"}),a.jsx("input",{type:"date",name:"scheduled_date",value:c.scheduled_date,onChange:d,className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium dark:text-gray-300",children:"Exercises"}),(x=c.exercises)==null?void 0:x.map((p,w)=>a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsxs("select",{value:p.exercise_id,onChange:v=>h(w,"exercise_id",v.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[a.jsx("option",{value:"",children:"Select exercise"}),n.map(v=>a.jsx("option",{value:v.id,children:v.name},v.id))]}),a.jsx("button",{type:"button",onClick:()=>g(w),className:"text-red-500 text-sm font-medium",children:"Remove"})]},w)),a.jsx("button",{type:"button",onClick:f,className:"mt-2 text-indigo-600 font-medium hover:underline",children:"Add Exercise"})]})]}),a.jsxs("div",{className:"mt-6 flex justify-end gap-4",children:[a.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 dark:bg-gray-800 text-white rounded-md hover:bg-gray-600",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Save"})]})]})}function Go({onWorkoutCreated:s}){const[e,t]=m.useState(!1),r=()=>{t(!1),s&&s()};return a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>t(!0),className:"flex items-center space-x-2 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700",children:[a.jsx(Br,{className:"h-5 w-5"}),a.jsx("span",{children:"Create Workout"})]}),e&&a.jsx("div",{className:"fixed inset-0 dark:bg-gray-800 bg-opacity-75 flex items-center justify-center p-4",children:a.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 ai-style-change-1 dark:bg-gray-700 dark:text-gray-300 dark:shadow-gray-900",children:a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:"text-2xl font-bold dark:text-gray-100 mb-6",children:"Create New Workout"}),a.jsx(Yo,{onClose:r,onCreate:s})]})})})]})}function Ko(){const[s,e]=m.useState([]),[t,r]=m.useState(!0),n=async()=>{try{const{data:i,error:o}=await _.from("workouts").select(`
              *,
              workout_exercises (
                *,
                exercise:exercises (*)
              )
            `).order("created_at",{ascending:!1});if(o)throw o;e(i||[])}catch(i){console.error("Error fetching workouts:",i)}finally{r(!1)}};return m.useEffect(()=>{n()},[]),t?a.jsx(Q,{}):a.jsxs("div",{className:"space-y-6",children:[a.jsx(Go,{onWorkoutCreated:n}),s.map(i=>a.jsx(Vo,{workout:i,onDelete:n},i.id))]})}function Qo(){const[s,e]=m.useState([]),[t,r]=m.useState(new Date);return m.useEffect(()=>{async function n(){const{data:i}=await _.from("workouts").select("*").gte("scheduled_date",new Date().toISOString().split("T")[0]).order("scheduled_date");i&&e(i)}n()},[]),a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Scheduled Workouts"}),a.jsxs("div",{className:"space-y-4",children:[s.map(n=>a.jsx("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:n.name}),a.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[a.jsx(Be,{className:"h-4 w-4 mr-1"}),a.jsx("span",{children:new Date(n.scheduled_date).toLocaleDateString()})]})]})},n.id)),s.length===0&&a.jsx("p",{className:"text-gray-500 text-center py-4",children:"No upcoming scheduled workouts"})]})]})}function Xo(){const[s,e]=m.useState([]);m.useEffect(()=>{(async()=>{try{const{data:n,error:i}=await _.from("workouts").select("*");i?console.error("Error connecting to Supabase:",i):console.log("Fetched workouts:",n)}catch(n){console.error("Error while querying Supabase:",n)}})()},[]);const t=async()=>{const{data:r,error:n}=await _.from("workouts").select();n?console.error("Error fetching workouts:",n):e(r)};return m.useEffect(()=>{t()},[]),a.jsxs("div",{className:"space-y-8",children:[a.jsx("div",{className:"flex justify-between items-center",children:a.jsx("h1",{className:"text-3xl font-bold dark:text-gray-100",children:"Workouts"})}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(Ko,{workouts:s})}),a.jsx("div",{children:a.jsx(Qo,{})})]})]})}function Zo(){const[s,e]=m.useState([]),[t,r]=m.useState(!0),[n,i]=m.useState(new Date),{user:o}=J();m.useEffect(()=>{async function d(){try{r(!0);const h=q(n,"yyyy-MM-dd"),{data:f,error:g}=await _.from("workouts").select("id").eq("is_wod",!0).eq("scheduled_date",h);if(g||!(f!=null&&f.length)){e([]);return}const{data:x,error:p}=await _.from("workout_logs").select(`
            total,
            profiles!inner(id, profile_name)
          `).in("workout_id",f.map(y=>y.id));if(p){console.error("Error fetching logs:",p);return}const v=(await Promise.all(x.map(async y=>{const k=y.profiles;if(!k)return null;const{count:P}=await _.from("likes").select("*",{count:"exact",head:!0}).eq("profile_id",k.id);return{id:k.id,profile_name:k.profile_name||"Anonymous",daily_score:y.total||0,likes:P||0,hasLiked:!1}}))).reduce((y,k)=>{if(!k)return y;const P=y.find(D=>D.id===k.id);return P?P.daily_score=Math.max(P.daily_score,k.daily_score):y.push(k),y},[]);e(v.sort((y,k)=>k.daily_score-y.daily_score).slice(0,10))}catch(h){console.error("Error fetching rankings:",h)}finally{r(!1)}}d()},[n]);const c=async d=>{if(!(!o||d===o.id))try{e(f=>f.map(g=>g.id===d?{...g,likes:g.likes+1,hasLiked:!0}:g));const{error:h}=await _.from("likes").insert({user_id:o.id,profile_id:d});if(h)throw h}catch(h){e(f=>f.map(g=>g.id===d?{...g,likes:g.likes-1,hasLiked:!1}:g)),console.error("Like failed:",h)}},l=()=>i(d=>Kr(d,1)),u=()=>i(d=>Ue(d,1));return a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100",children:"WOD Leaderboard"}),a.jsx("p",{className:"text-sm text-gray-500",children:q(n,"MMM do, yyyy")})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:l,className:"date-nav-button",children:"Previous"}),a.jsx("button",{onClick:u,className:"date-nav-button",children:"Next"})]})]}),t?a.jsx(Q,{}):s.length>0?s.map((d,h)=>a.jsxs("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-4 ",children:[a.jsx(ec,{index:h}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:d.profile_name}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Score: ",d.daily_score]})]})]}),a.jsx(tc,{likes:d.likes,hasLiked:d.hasLiked,isSelf:d.id===(o==null?void 0:o.id),onClick:()=>c(d.id)})]},d.id)):a.jsx("p",{className:"text-center text-gray-500 py-4",children:"No WOD results for this date"})]})}const ec=({index:s})=>s===0?a.jsx(He,{className:"h-6 w-6 text-yellow-500"}):s===1?a.jsx(Xt,{className:"h-6 w-6 text-gray-400"}):s===2?a.jsx(Xt,{className:"h-6 w-6 text-amber-600"}):a.jsx("span",{className:"w-6 text-center font-medium text-gray-500",children:s+1}),tc=({likes:s,hasLiked:e,isSelf:t,onClick:r})=>a.jsxs("button",{onClick:r,disabled:e||t,className:"like-button",children:[a.jsx(Wa,{className:`h-5 w-5 ${e?"text-red-600":"text-gray-500"}`}),a.jsx("span",{className:"ml-1",children:s})]});function rc(){const[s,e]=m.useState([]),[t,r]=m.useState(!0);return m.useEffect(()=>{async function n(){try{r(!0);const i=new Date(Date.now()-7*24*60*60*1e3).toISOString(),{data:o,error:c}=await _.from("workout_logs").select(`
            user_id,
            profiles (
              id,
              first_name,
              last_name,
              profile_name
            )
          `).gte("completed_at",i);if(c)throw c;if(!o||o.length===0){e([]);return}const l=o.reduce((d,h)=>{const f=h.profiles;return f&&(d[f.id]||(d[f.id]={id:f.id,profile_name:f.profile_name||"",first_name:f.first_name||"",last_name:f.last_name||"",workout_count:0}),d[f.id].workout_count++),d},{}),u=Object.values(l).sort((d,h)=>h.workout_count-d.workout_count).slice(0,5);e(u)}catch(i){console.error("Error fetching top performers:",i),e([])}finally{r(!1)}}n()},[]),t?a.jsx(Q,{}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Top Performers"}),a.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Last 7 days"}),a.jsxs("div",{className:"space-y-4",children:[s.map(n=>a.jsx("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(Ya,{className:"h-5 w-5 text-yellow-500"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:n.profile_name||`${n.first_name} ${n.last_name}`}),a.jsxs("p",{className:"text-sm text-gray-500",children:[n.workout_count," workouts"]})]})]})},n.id)),s.length===0&&a.jsx("p",{className:"text-center text-gray-500 py-4",children:"No top performers this week"})]})]})}function sc(){const[s,e]=m.useState([]),[t,r]=m.useState(!0),[n,i]=m.useState(null);return m.useEffect(()=>{async function o(){try{r(!0),i(null);const{data:c,error:l}=await _.from("exercise_scores").select("*").order("created_at",{ascending:!1});if(l)throw l;if(!c||c.length===0){e([]),r(!1);return}const u=[...new Set(c.map(y=>y.exercise_id))],{data:d,error:h}=await _.from("exercises").select("*").in("id",u);if(h)throw h;const f=c.filter(y=>y.workout_id).map(y=>y.workout_id).filter(y=>!!y);let g={};if(f.length>0){const{data:y,error:k}=await _.from("workout_logs").select("id, workout_type, completed_at").in("id",f);if(k)throw k;y&&(g=y.reduce((P,D)=>(P[D.id]={type:D.workout_type||"",completed_at:D.completed_at},P),{}))}const x=c.map(y=>{const k=d==null?void 0:d.find(D=>D.id===y.exercise_id),P=y.workout_id?g[y.workout_id]:null;return{...y,exercise:k,workout_type:(P==null?void 0:P.type)||"",date:(P==null?void 0:P.completed_at)||y.created_at}}),p={};x.forEach(y=>{var P;if(!((P=y.exercise)!=null&&P.name))return;const k=y.exercise.name;p[k]||(p[k]=[]),p[k].push(y)});const w=[];Object.entries(p).forEach(([y,k])=>{if(y==="Run"){const P=k.reduce((D,F)=>(F.distance||0)>(D.distance||0)?F:D,k[0]);w.push(P)}else if(y==="Assault Bike"){const P=k.reduce((D,F)=>(F.calories||0)>(D.calories||0)?F:D,k[0]);w.push(P)}else{const P=k.reduce((D,F)=>(F.weight||0)>(D.weight||0)?F:D,k[0]);w.push(P)}});const v=w.sort((y,k)=>new Date(k.date).getTime()-new Date(y.date).getTime()).slice(0,5);e(v)}catch(c){console.error("Error fetching exercise records:",c),i("Failed to load exercise records. Please try again later.")}finally{r(!1)}}o()},[]),t?a.jsx(Q,{}):n?a.jsx("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:a.jsx("p",{className:"text-red-500 text-center",children:n})}):a.jsxs("div",{className:"bg-white dark:bg-darkBackground dark:text-gray-100 dark:text-gray-200 rounded-lg shadow-md p-6 transition-all duration-300",children:[a.jsx("h2",{className:"text-xl font-bold dark:text-gray-100 mb-4",children:"Exercise Records"}),a.jsxs("div",{className:"space-y-4",children:[s.map(o=>{var c,l,u;return a.jsxs("div",{className:"flex items-center justify-between p-3 dark:bg-gray-800 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(xe,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium dark:text-gray-100",children:((c=o.exercise)==null?void 0:c.name)||"Unknown Exercise"}),a.jsx("div",{className:"text-sm text-gray-500",children:((l=o.exercise)==null?void 0:l.name)==="Run"?a.jsxs(a.Fragment,{children:[o.distance||0," meters"]}):((u=o.exercise)==null?void 0:u.name)==="Assault Bike"?a.jsxs(a.Fragment,{children:[o.calories||0," calories"]}):a.jsxs(a.Fragment,{children:[o.weight||0," lbs ",o.reps>0&&` ${o.reps} reps`]})})]})]}),a.jsx("div",{className:"text-sm text-gray-500",children:new Date(o.date).toLocaleDateString()})]},o.id)}),s.length===0&&a.jsx("p",{className:"text-center text-gray-500 py-4",children:"No exercise records yet"})]})]})}function nc(){return a.jsxs("div",{className:"space-y-8",children:[a.jsx("h1",{className:"text-3xl font-bold dark:text-gray-100",children:"Leaderboard"}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(Zo,{})}),a.jsxs("div",{className:"space-y-8",children:[a.jsx(rc,{}),a.jsx(sc,{})]})]})]})}function ac(){const[s,e]=m.useState("https://res.cloudinary.com/dvmv00x0y/image/upload/v1718219988/workout-app/fitness_q0q09j.jpg"),[t,r]=m.useState(!0),[n,i]=m.useState("");return m.useEffect(()=>{async function o(){try{const{data:c,error:l}=await _.from("app_settings").select("value").eq("key","welcome_image_url").single();l?console.error("Error fetching welcome image URL:",l):c&&(i(c.value),console.log("Fetched image URL:",c.value))}catch(c){console.error("Error fetching welcome image URL:",c)}finally{r(!1)}}o()},[]),m.useEffect(()=>{n&&e(n)},[n]),a.jsxs("div",{className:"text-center flex flex-col items-center",children:[a.jsx("h1",{className:"text-4xl font-bold dark:text-gray-100 mb-4",children:"Welcome to Primal Lifts"}),a.jsx("p",{className:"text-lg dark:text-gray-300 mb-8",children:"Workouts are scored by adding total weight moved and calories together for a total score! This app was built for those with a busy schedule and may need help keeping up with  exercises you've completed and what you have left with weekly tracking."}),a.jsx("p",{className:"text-lg dark:text-gray-300 mb-8",children:"This app allows you to focus on the basic lifts but you can customize them in the settings menu."}),!t&&a.jsx("img",{src:s,alt:"Fitness",className:"mx-auto rounded-lg shadow-md mb-8 max-w-full",style:{maxWidth:"90%",height:"auto"}}),a.jsx("p",{className:"dark:text-gray-300",children:"Use the navigation bar to access different features."})]})}function ic(){const{user:s}=J(),[e,t]=m.useState([]),[r,n]=m.useState(""),[i,o]=m.useState(!0),[c,l]=m.useState(null);m.useEffect(()=>{async function h(){o(!0);try{const{data:f,error:g}=await _.from("messages").select(`
            id,
            user_id,
            content,
            created_at,
            profiles (
              profile_name
            )
          `).order("created_at",{ascending:!1});if(g)throw g;const x=f.map(p=>{var w;return{...p,profile_name:((w=p.profiles)==null?void 0:w.profile_name)||"Anonymous"}});t(x)}catch(f){console.error("Error fetching messages:",f),l("Failed to load messages. Please try again later.")}finally{o(!1)}}h()},[]);const u=async()=>{if(s&&r.trim())try{const{data:h,error:f}=await _.from("messages").insert([{user_id:s.id,content:r}]).select().single();if(f)throw f;t(g=>[{...h,profile_name:s.email},...g]),n(""),window.OneSignalDeferred=window.OneSignalDeferred||[],window.OneSignalDeferred.push(async function(g){(await g.getTags()).message_board_notifications==="true"&&(g.sendTag("message_board_notifications","true"),g.push(["sendNotification",{contents:{en:r},headings:{en:`New message from ${s.email}`},included_segments:["Subscribed Users"]}]))})}catch(h){console.error("Error posting message:",h),l("Failed to post message. Please try again.")}},d=async h=>{try{const{error:f}=await _.from("messages").delete().eq("id",h);if(f)throw f;t(g=>g.filter(x=>x.id!==h))}catch(f){console.error("Error deleting message:",f),l("Failed to delete message. Please try again.")}};return i?a.jsx(Q,{}):a.jsxs("div",{className:"container mx-auto p-4",children:[a.jsx("h1",{className:"text-3xl font-bold mb-4 dark:text-gray-100",children:"Message Board"}),c&&a.jsx("div",{className:"rounded-md bg-red-50 p-4 mb-4",children:a.jsx("p",{className:"text-sm text-red-700",children:c})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("textarea",{value:r,onChange:h=>n(h.target.value),placeholder:"Write a message...",className:"w-full p-2 border rounded-md dark:bg-gray-700 dark:text-gray-200"}),a.jsx("button",{onClick:u,className:"mt-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Post Message"})]}),a.jsx("div",{children:e.map(h=>a.jsx("div",{className:"mb-4 p-4 rounded-md shadow-md dark:bg-gray-800 dark:text-gray-100",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:h.profile_name}),a.jsx("p",{className:"text-sm text-gray-500",children:new Date(h.created_at).toLocaleDateString()}),a.jsx("p",{className:"mt-2",children:h.content})]}),(s==null?void 0:s.id)===h.user_id&&a.jsx("button",{onClick:()=>d(h.id),className:"text-red-600 hover:text-red-700",children:a.jsx(ge,{className:"h-4 w-4"})})]})},h.id))})]})}function oc(){return m.useEffect(()=>{window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{e.matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),a.jsx(is,{children:a.jsx(Da,{children:a.jsxs("div",{className:"min-h-screen dark:bg-gray-700 dark:text-gray-100 dark:bg-gray-800 dark:text-white",children:[a.jsx(Ka,{}),a.jsx("div",{className:"container mx-auto px-4 py-8 bg-gray-200",children:a.jsxs(os,{children:[a.jsx(te,{path:"/login",element:a.jsx(Qa,{})}),a.jsx(te,{path:"/register",element:a.jsx(Xa,{})}),a.jsx(te,{path:"/",element:a.jsx(ue,{children:a.jsx(ac,{})})}),a.jsx(te,{path:"/wod",element:a.jsx(ue,{children:a.jsx($o,{})})}),a.jsx(te,{path:"/profile",element:a.jsx(ue,{children:a.jsx(Io,{})})}),a.jsx(te,{path:"/settings",element:a.jsx(ue,{children:a.jsx(Jo,{})})}),a.jsx(te,{path:"/workouts",element:a.jsx(ue,{children:a.jsx(Xo,{})})}),a.jsx(te,{path:"/leaderboard",element:a.jsx(ue,{children:a.jsx(nc,{})})}),a.jsx(te,{path:"/messageboard",element:a.jsx(ue,{children:a.jsx(ic,{})})})]})})]})})})}const cc=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone;cc&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.classList.add("dark"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{s.matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}));pr(document.getElementById("root")).render(a.jsx(m.StrictMode,{children:a.jsx(oc,{})}));"serviceWorker"in navigator&&(console.log("Service Worker is supported"),navigator.serviceWorker.ready.then(s=>{console.log("Service Worker Registered:",s)}).catch(s=>{console.error("Service Worker Registration Error:",s)}));const lc=[{name:"Reading Mode",match:["*://example.com/*","*://*.example.com/*"],description:"Adds a reading mode button that simplifies the page layout",enabled:!0,code:function(){const s=document.createElement("button");s.innerHTML="",s.style.cssText=`
                position: fixed;
                bottom: 70px;
                right: 20px;
                z-index: 9999;
                padding: 10px;
                border-radius: 50%;
                border: none;
                background: #2196f3;
                color: white;
                cursor: pointer;
                width: 40px;
                height: 40px;
                font-size: 20px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            `,s.onmouseover=()=>s.style.transform="scale(1.1)",s.onmouseout=()=>s.style.transform="scale(1)",document.body.appendChild(s);const e=document.createElement("style");e.innerHTML=`
                body.reading-mode {
                    width: 100% !important;
                    max-width: 100% !important;
                    margin: 0 !important;
                    padding: 0 !important;
                }
                body.reading-mode > * {
                    display: none !important;
                }
                body.reading-mode article,
                body.reading-mode main,
                body.reading-mode .content,
                body.reading-mode [role="main"] {
                    display: block !important;
                    width: 90% !important;
                    max-width: 800px !important;
                    margin: 0 auto !important;
                    padding: 20px !important;
                    font-size: 18px !important;
                    line-height: 1.6 !important;
                }
                body.reading-mode img {
                    max-width: 100% !important;
                    height: auto !important;
                    margin: 20px auto !important;
                    display: block !important;
                }
                body.reading-mode h1, 
                body.reading-mode h2, 
                body.reading-mode h3 {
                    margin: 1.5em 0 0.5em 0 !important;
                }
                body.reading-mode p {
                    margin: 1em 0 !important;
                }
            `,document.head.appendChild(e),document.addEventListener("darkModeChanged",n=>{n.detail.enabled&&(e.innerHTML+=`
                        body.reading-mode {
                            background-color: #1a1a1a !important;
                            color: #ffffff !important;
                        }
                    `)});let t=!1;function r(){t=!t,document.body.classList.toggle("reading-mode",t),s.style.background=t?"#4CAF50":"#2196f3",localStorage.setItem("readingMode",t),document.dispatchEvent(new CustomEvent("readingModeChanged",{detail:{enabled:t}}))}localStorage.getItem("readingMode")==="true"&&r(),s.addEventListener("click",r)}},{name:"Auto Scroll",match:["*://example.com/*"],description:"Adds an auto-scroll feature with speed control",enabled:!0,code:function(){const s=document.createElement("div");s.style.cssText=`
                position: fixed;
                bottom: 120px;
                right: 20px;
                z-index: 9999;
                background: white;
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                display: flex;
                flex-direction: column;
                gap: 5px;
                transition: all 0.3s ease;
            `;const e=document.createElement("button");e.innerHTML="",e.style.cssText=`
                border: none;
                background: #2196f3;
                color: white;
                cursor: pointer;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 20px;
            `;const t=document.createElement("input");t.type="range",t.min="1",t.max="10",t.value=localStorage.getItem("autoScrollSpeed")||"5",t.style.width="100px",s.appendChild(e),s.appendChild(t),document.body.appendChild(s),document.addEventListener("darkModeChanged",o=>{s.style.backgroundColor=o.detail.enabled?"#333":"white",t.style.backgroundColor=o.detail.enabled?"#444":"#ddd"}),document.addEventListener("readingModeChanged",o=>{o.detail.enabled&&r&&i()});let r=!1,n;function i(){r=!r,e.innerHTML=r?"":"",r?n=setInterval(()=>{window.scrollBy(0,t.value)},50):clearInterval(n),localStorage.setItem("autoScrolling",r)}e.addEventListener("click",i),t.addEventListener("input",()=>{localStorage.setItem("autoScrollSpeed",t.value),r&&(clearInterval(n),n=setInterval(()=>{window.scrollBy(0,t.value)},50))}),localStorage.getItem("autoScrolling")==="true"&&i()}}];class dc{constructor(){this.scripts=lc}matchUrl(e,t){const r=e.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,"\\?");return new RegExp(`^${r}$`).test(t)}shouldRunOnUrl(e,t){return e.match.some(r=>this.matchUrl(r,t))}async injectScripts(e){try{const t=e.src,r=this.scripts.filter(n=>n.enabled&&this.shouldRunOnUrl(n,t));for(const n of r)try{await new Promise(o=>{e.contentDocument.readyState==="complete"?o():e.onload=o});const i=e.contentDocument.createElement("script");i.textContent=`(${n.code.toString()})();`,e.contentDocument.body.appendChild(i),console.log(`Injected script: ${n.name}`)}catch(i){console.error(`Error injecting script ${n.name}:`,i)}}catch(t){console.error("Error in script injection:",t)}}}window.userScriptManager=new dc;const uc=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone;function hr(s){s.matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}if(uc){const s=window.matchMedia("(prefers-color-scheme: dark)");hr(s),s.addEventListener("change",hr)}
